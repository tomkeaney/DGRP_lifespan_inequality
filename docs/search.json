[
  {
    "objectID": "GWAS.html",
    "href": "GWAS.html",
    "title": "Genome wide analyses",
    "section": "",
    "text": "Note that the MASS package is required to run the CPASSOC. Unfortunately this clashes with the dplyr select(). So be prepared to run detach(\"package:MASS\", unload=TRUE) or use dplyr::select() to get some things to work if you’re moving back and forth throughout the code.\n\n\nShow the code\nlibrary(tidyverse) # tidy coding, ggplot etc\nlibrary(glue) # for coding within strings\nlibrary(bigsnpr) # to install:   devtools::install_github(\"privefl/bigsnpr\")\nlibrary(pander) # for tables\nlibrary(future.apply) # for parallel code running\nlibrary(brms) # for bayesian models\nlibrary(ggtext) # for markdown syntax in ggplot\nlibrary(MetBrewer) # for more colour palettes\nlibrary(MoMAColors) # nicer colours once again\nlibrary(PNWColors) # further nicer colours\nlibrary(patchwork) # building composite plots\nlibrary(DT) # for nice tables\nlibrary(kableExtra) # for more nice tables\nlibrary(ggrepel) # for labelling ggplots\nlibrary(pheatmap) # for heat maps\nlibrary(MASS) # needed for CPASSOC\nlibrary(Matrix) # needed for CPASSOC\nlibrary(flexsurv) # needed for sampling from the gompertz distribution\n\n# build a helper function that produces a table to display our data\n\n# Create a function to build HTML searchable tables\n\nmy_data_table &lt;- function(df){\n  datatable(\n    df, rownames=FALSE,\n    autoHideNavigation = TRUE,\n    extensions = c(\"Scroller\",  \"Buttons\"),\n    options = list(\n      autoWidth = TRUE,\n      dom = 'Bfrtip',\n      deferRender=TRUE,\n      scrollX=TRUE, scrollY=1000,\n      scrollCollapse=TRUE,\n      buttons =\n        list('pageLength', 'colvis', 'csv', list(\n          extend = 'pdf',\n          pageSize = 'A4',\n          orientation = 'landscape',\n          filename = 'Lifespan_data')),\n      pageLength = 100\n    )\n  )\n}"
  },
  {
    "objectID": "GWAS.html#install-neccessary-software-and-build-helper-functions",
    "href": "GWAS.html#install-neccessary-software-and-build-helper-functions",
    "title": "Genome wide analyses",
    "section": "Install neccessary software and build helper functions",
    "text": "Install neccessary software and build helper functions\nIn addition to the R packages we load, plink 1.9 and beagle must also be installed. These software packages allow us to wrangle the data into the correct format and impute missing values, both of which are required to run GWAS with the Gemma R package.\n\n\nShow the code\n# build a function to prepare data for GWAS\n\nprep_for_e0_GWAS &lt;- function(data, sex){\ndata %&gt;% \n  #inner_join(read_csv(\"data/Input/Genotyped_lines.csv\"), by = \"line\") %&gt;%  # filter to lines that have been genotyped\n  mutate(line = glue(\"line{line}\")) %&gt;% \n  dplyr::select(line, e0) %&gt;% \n    mutate(e0 = scale(e0))\n}\n\nprep_for_h_GWAS &lt;- function(data, sex){\ndata %&gt;% \n  #inner_join(read_csv(\"data/Input/Genotyped_lines.csv\"), by = \"line\") %&gt;%  # filter to lines that have been genotyped\n  mutate(line = glue(\"line{line}\")) %&gt;% \n  dplyr::select(line, h) %&gt;% \n    mutate(h = scale(h))\n}\n\nprep_for_SA_GWAS &lt;- function(data){\ndata %&gt;% \n  dplyr::select(line, SA_axis)\n}\n\n# I used bigsnpr::download_plink(dir = \"code\") which puts it in the code folder - I'm using a windows operating system.\n\n# Beagle is a software package for phasing genotypes and imputing ungenotyped markers.\n\nplink &lt;- paste(getwd(), \"code/plink\", sep = \"/\")\n#beagle &lt;- bigsnpr::download_beagle() unocmment to download\n\n\n# # Load the wolbachia infection status data from the DGRP website\n# wolbachia &lt;- read_csv(\"data/input/wolbachia.csv\") %&gt;% \n#   mutate(line = paste(\"line\", line, sep = \"\"))\n# \n# # Load the chomosomal inversion data from the DGRP website\n# # these are the 5 inversions that Huang et al. PNAS corrected for\n# inversions &lt;- read_csv(\"data/input/inversion genotypes.csv\") %&gt;%\n#     mutate(line = paste(\"line\", line, sep = \"\")) %&gt;%\n#     select(line, `In(2L)t`, `In(2R)NS`, `In(3R)P`, `In(3R)K`, `In(3R)Mo`) \n\n# helper function to pass commands to the terminal\n# Note that we set `intern = TRUE`, and pass the result of `system()` to `cat()`, \n# ensuring that the Terminal output will be printed in this knitr report.\n# \n# This is the mac OS function\n \n#run_command &lt;- function(shell_command, wd = getwd(), path = \"\"){\n#  cat(system(glue(\"cd \", wd, path, # tell terminal which directory to work in\n#                  \"\\n\",shell_command), # on a second terminal line, run the plink command\n#             intern = TRUE), sep = '\\n')  \n#}\n\n# This is the windows function \n\nrun_command &lt;- function(plink_command, wd = getwd(), path = \"\") {\n  # Specify the full path to the plink executable within the 'code' subdirectory.\n  plink_path &lt;- paste(getwd(), \"code/plink\", sep = \"/\")\n  \n  # Create the full shell command with the plink executable.\n  command &lt;- glue(\"cmd.exe /c cd /d {shQuote(file.path(wd, path))} && {shQuote(plink_path)} {plink_command}\")\n  \n  # Execute the combined command.\n  result &lt;- system(command, intern = TRUE)\n  \n  # Print the result.\n  cat(result, sep = '\\n')\n  \n  # Return the result as a character vector.\n  return(result)\n}\n\n# sometimes we need to run terminal commands without plink - create a slightly different function to do this\n\nrun_command_no_plink &lt;- function(shell_command, wd = getwd(), path = \"\") {\n  \n  # Create the full shell command with the plink executable.\n  command &lt;- glue(\"cmd.exe /c cd /d {shQuote(file.path(wd, path))} && {shell_command}\")\n  \n  # Execute the combined command.\n  result &lt;- system(command, intern = TRUE)\n  \n  # Print the result.\n  cat(result, sep = '\\n')\n  \n  # Return the result as a character vector.\n  return(result)\n}"
  },
  {
    "objectID": "GWAS.html#build-a-function-to-create-manhattan-plots-for-later",
    "href": "GWAS.html#build-a-function-to-create-manhattan-plots-for-later",
    "title": "Genome wide analyses",
    "section": "Build a function to create manhattan plots for later",
    "text": "Build a function to create manhattan plots for later\n\n\nShow the code\nbuild_manhattan_plot &lt;- function(gwas_results){\n  \n  manhattan_data &lt;- gwas_results %&gt;%\n    mutate(position = str_split(SNP, \"_\"), # split the SNP name into logical bits\n           chr = map_chr(position, ~ .x[1]), # the first bit is the chromosome arm - name the column appropriately\n           position = as.numeric(map_chr(position, ~ .x[2])), # where on the chromosome is the SNP found\n           pval = -1 * log10(P)) %&gt;% # make visualising the p values easier\n    dplyr::select(chr, position, pval) %&gt;% \n    filter(chr != \"4\")\n  \n  # this next chunk finds convenient cuts for labels and colour changes \n  \n  max_pos &lt;- manhattan_data %&gt;%\n    group_by(chr) %&gt;%\n    summarise(\n      max_pos = max(position), \n      middle_pos = (max_pos - min(position)) / 2,\n      .groups = \"drop\") %&gt;%\n    as.data.frame()\n  \n  max_pos$max_pos &lt;- c(0, cumsum(max_pos$max_pos[1:4]))\n  \n  max_pos$label_pos &lt;- max_pos$max_pos + max_pos$middle_pos\n  \n  # combine the two dataframes created above\n  \n  manhattan_data &lt;- manhattan_data %&gt;%\n    left_join(max_pos, by = \"chr\") %&gt;%\n    mutate(position = position + max_pos,\n           chromosome_colour = case_when(chr == \"2L\" | chr == \"3L\" | chr == \"X\" ~ \"A\",\n                                         .default = \"B\"),\n           Notable = if_else(pval &gt;= -log10(0.00000005), \"YES\", \"NO\"))\n  \n  plot &lt;- manhattan_data %&gt;%\n    #filter(Notable == \"NO\") %&gt;% \n    ggplot(aes(position, pval, group = chr, stroke = 0.01)) +\n    geom_point(aes(colour = chromosome_colour), size = 1.6) +\n    geom_hline(yintercept = -log10(0.00000005), linetype = 2, colour = \"red\", linewidth = 1.2) +\n    geom_hline(yintercept = -log10(0.00005), linetype = 2, colour = \"orange\", linewidth = 1.2) +\n    scale_colour_manual(values = c(met.brewer(name = \"Hokusai3\")[3], met.brewer(name = \"Hokusai3\")[6])) +\n    #geom_label_repel(data = manhattan_data %&gt;% filter(common_SNP == \"YES\" &),  \n     #              aes(label = position, fill = \"aliceblue\")) +\n    #geom_point(data = manhattan_data %&gt;% filter(Notable == \"YES\"),\n     #          fill = \"aliceblue\", size = 3, \n      #         shape = 21, colour = \"grey2\") +\n    scale_x_continuous(breaks = max_pos$label_pos, labels = max_pos$chr) +\n    scale_y_continuous(expand = c(0,0)) +\n    ylab(\"-log~10~(_p_)\") + \n    xlab(\"Chromosome and position\") +\n    theme_classic() +\n    theme(legend.position = \"none\",\n          axis.title.y = element_markdown(size = 18),\n          axis.title.x = element_markdown(size = 18),\n          axis.text.x = element_text(size = 15),\n          axis.text.y = element_text(size = 15))  \n}"
  },
  {
    "objectID": "GWAS.html#perform-snp-quality-control-and-impute-missing-data",
    "href": "GWAS.html#perform-snp-quality-control-and-impute-missing-data",
    "title": "Genome wide analyses",
    "section": "Perform SNP quality control and impute missing data",
    "text": "Perform SNP quality control and impute missing data\nWe cleaned up the DGRP’s .bed/.bim/.fam files (available from the Mackay lab website) by:\n\nRemoving any SNPs for which genotypes are missing for &gt;10% of the DGRP lines. We then use the software Beagle to impute the remaining missing genotypes. Imputation takes a long time so ideally, you only want to do it once.\nRemoving SNPs with a minor allele frequency of less than 5%. We have negilible power to detect associations for rare SNPs below this threshold.\n\nIn the PLINK-formatted genotype files, lines fixed for the major allele are coded as 2, and lines fixed for the minor allele as 0. This means that in the association tests we calculate, negative effect sizes mean that the minor allele is associated with lower trait values, while positive effect sizes means that the minor allele is associated with higher trait values.\n\n\nShow the code\nRun_function &lt;- FALSE # Change this to TRUE to run the models\n\n# If the imputation is not already done, create the following 3 files of imputed genotype data: \n# dgrp2_QC_all_lines_imputed_correct.bed/bim/fam\nif(!file.exists(\"data/Derived/dgrp2_QC_all_lines_imputed_correct.bed\")) {\n  perform_SNP_QC_and_imputation(phenotypes = predicted_line_means)\n}\n\nif(Run_function){\n  \n  # Use Plink to clean and subset the DGRP's SNP data as follows:\n  # Only keep SNPs for which at least 90% of DGRP lines were successfully genotyped (--geno 0.1)\n  # Only keep SNPs with a minor allele frequency of 0.05 or higher (--maf 0.05)\n  # Finally, write the processed BIM/BED/FAM files to the data/derived directory\n  \n  output_directory &lt;-  paste(getwd(), \"data/Derived\", sep = \"/\")\n  \n  run_command(glue(\"--bfile dgrp2\",\n                   \" --geno 0.1 --maf 0.05 --allow-no-sex\", \n                   \" --make-bed --out {shQuote(output_directory)}/dgrp2_QC_all_lines\"), path = \"data/Input/\")\n  \n  # Use the shell command 'sed' to remove underscores from the DGRP line names in the .fam file (e.g. 'line_120' becomes 'line120')\n  # Otherwise, these underscores cause trouble when we need to convert from PLINK to vcf format (vcf format uses underscore as a separator)\n  # I manually edited the text file to do this rather than using the below command, which I don't have quite working\n  #for(i in 1:2) run_command_no_plink(\"sed -i '' 's/_//' dgrp2_QC_all_lines.fam\", path = \"/data/Derived/\")\n                \n  \n  # Now impute the missing genotypes using Beagle\n  # This part uses the data for the full DGRP panel of &gt;200 lines, to infer missing genotypes as accurately as possible. \n  # This step uses a lot of memory (max memory was set to 28MB in prior analysis, and it used 26.5GB), but maybe it can also run on a less powerful computer?\n  # The bigsnpr package provides a helpful wrapper for Beagle called snp_beagleImpute(): it translates to a VCF file and back again using PLINK\n  snp_beagleImpute(beagle, plink, \n                   bedfile.in = \"data/Derived/dgrp2_QC_all_lines.bed\", \n                   bedfile.out = \"data/Derived/dgrp2_QC_all_lines_imputed.bed\",\n                   ncores = 4, \n                   memory.max = 16)\n  \n  # assign a sex of 'female' to all the DGRP lines (Beagle removes the sex, and it seems PLINK needs individuals to have a sex, \n  # despite PLINK having a command called --allow-no-sex)\n  run_command(\"sed -i '' 's/    0   0   0/  0   0   2/' dgrp2_QC_all_lines_imputed.fam\", path = \"/data/Derived/\")\n  \n  # Re-write the .bed file, to make sure the MAF threshold and minor/major allele designations are correctly assigned post-Beagle\n  run_command(glue(\"--bfile dgrp2_QC_all_lines_imputed\",\n                   \" --geno 0.1 --maf 0.05 --allow-no-sex\", \n                   \" --make-bed --out dgrp2_QC_all_lines_imputed_correct\"), path = \"/data/Derived/\")\n  #unlink(list.files(\"data/derived\", pattern = \"~\", full.names = TRUE)) # delete the original files, which were given a ~ file name by PLINK\n} else \"Already run\"\n\n\n[1] \"Already run\""
  },
  {
    "objectID": "GWAS.html#create-a-reduced-list-of-ld-pruned-snps-with-plink",
    "href": "GWAS.html#create-a-reduced-list-of-ld-pruned-snps-with-plink",
    "title": "Genome wide analyses",
    "section": "Create a reduced list of LD-pruned SNPs with PLINK",
    "text": "Create a reduced list of LD-pruned SNPs with PLINK\nTo keep the computation time and memory usage manageable, we do not save the effect sizes for every variant (SNPs and indels) that passed the MAF and missingness quality control step above (1,646,672 variants). Instead, we save the effect sizes for a subset of variants that were approximately in linkage disequilibrium. We identified this LD-pruned set of variants using the PLINK arguments --indep-pairwise 100 10 0.2, which prunes within 100kB sliding windows, sliding 10 variants along with each step, and allows a maximum pairwise \\(r^2\\) threshold of 0.2 between loci. With these parameters, 1,419,902 variants were removed, leaving 226,770 for downstream analysis. Subsequent inspection of the Manhattan plots suggests that this method removes most (but perahps not all) variants that are in complete or high LD.\n\n\nShow the code\n# indep-pairwise arguments are: \n# 100kB window size, \n# variant count to shift the window by 10 variants at the end of each step, \n# pairwise r^2 threshold of 0.2\n\nif(!file.exists(\"data/Derived/dgrp2_QC_all_lines_imputed_correct.bed\")) {\n  run_command(glue(\"--bfile dgrp2_QC_all_lines_imputed_correct\",\n                 \" --indep-pairwise 100 10 0.2\"), path = \"data/Derived/\")\n}"
  },
  {
    "objectID": "GWAS.html#build-gwas-function",
    "href": "GWAS.html#build-gwas-function",
    "title": "Genome wide analyses",
    "section": "Build GWAS function",
    "text": "Build GWAS function\nNote: because PLINK defines the minor allele as the alternative allele (lines fixed for the minor allele are scored as genotype: 2, and those with the major allele as genotype: 0), a positive effect size in these association tests means the minor allele is associated with a higher value of the trait in question.\n\n\nShow the code\nrun_GWAS &lt;- function(phenotypes){\n  \n  # Make a list of the lines in our sample and save as a text file for passing to PLINK\n  lines_to_keep &lt;- phenotypes %&gt;% dplyr::select(line) %&gt;% mutate(line_2 = line)\n  write.table(lines_to_keep, \n              row.names = FALSE, \n              col.names = FALSE, \n              file = \"data/Derived/lines_to_keep.txt\", \n              quote = FALSE)\n\n  # Now cull the PLINK files to just the lines that we measured, and re-apply the \n  # MAF cut-off of 0.05 for the new smaller sample of DGRP lines\n  run_command(glue(\"--bfile dgrp2_QC_all_lines_imputed_correct\",\n                   \" --keep-allele-order\", # force PLINK to retain the major/minor allele designations that apply to the DGRP as a whole\n                   \" --keep lines_to_keep.txt --geno 0.1 --maf 0.05\", \n                   \" --make-bed --out dgrp2_QC_focal_lines\"), path = \"/data/Derived/\")\n  \n    # Define a function to add our phenotype data to a .fam file, which is needed for GWAS analysis and to make sure PLINK includes these samples\n  # The 'phenotypes' data frame needs to have a column called 'line'\n  add_phenotypes_to_fam &lt;- function(filepath, phenotypes){\n    read_delim(filepath, col_names = FALSE, delim = \" \") %&gt;% \n      dplyr::select(X1, X2, X3, X4, X5) %&gt;% # Get all the non-phenotype columns\n      left_join(phenotypes, \n                by = c(\"X1\" = \"line\")) %&gt;%\n      write.table(file = \"data/Derived/dgrp2_QC_focal_lines_NEW.fam\", \n                  col.names = FALSE, row.names = FALSE, \n                  quote = FALSE, sep = \" \")\n    \n    unlink(\"data/Derived/dgrp2_QC_focal_lines.fam\")\n    file.rename(\"data/Derived/dgrp2_QC_focal_lines_NEW.fam\", \n                \"data/Derived/dgrp2_QC_focal_lines.fam\")\n  }\n  \n  # edit the new FAM file to add the phenotype data from 'phenotypes'\n  add_phenotypes_to_fam(\"data/Derived/dgrp2_QC_focal_lines.fam\", phenotypes)\n  \n\n  # Run mixed-model GWAS (in practice, the relatedness between almost all pairs of lines \n  # is sufficiently low that PLINK always instead chooses to run a linear model)\n  \n  run_command(\"--bfile dgrp2_QC_focal_lines  --assoc --maf 0.05\", \n              path = \"/data/Derived\")\n  \n  # wrangle the GWAS results\n  \n  Focal_name &lt;- deparse(substitute(phenotypes))\n  \n  gwas_results &lt;- read.table(\"data/Derived/plink.qassoc\", \n                             header = TRUE) %&gt;% \n    dplyr::select(SNP, BETA, SE, \"T\", P)\n\n  # Save a file containing all SNPs with P &lt; 1e-5:\n  gwas_results %&gt;% \n    filter(P &lt; 1e-05) %&gt;% \n    write_tsv(glue(\"data/Derived/GWAS_results/{Focal_name}_significant_SNPs.tsv.gz\"))\n\n  # Rename and compress the GWAS summary stats file \n  # The filter step means that only variants in the LD-pruned subset get saved to disk.\n  gwas_results %&gt;% \n    filter(SNP %in% (pull(read_tsv(\"data/Derived/plink.prune.in\", col_names = \"SNP\"), SNP))) %&gt;% \n    write_tsv(glue(\"data/Derived/GWAS_results/{Focal_name}.tsv.gz\"))\n  unlink(\"data/Derived/plink.qassoc\")\n  \n  # Rename the plink log file\n  file.rename(\"data/Derived/plink.log\",\n              glue(\"data/Derived/{Focal_name}_log.txt\"))\n  \n  unlink(\"data/Derived/dgrp2_QC_focal_lines.bim\")\n  unlink(\"data/Derived/dgrp2_QC_focal_lines.bed\")\n  unlink(\"data/Derived/dgrp2_QC_focal_lines.fam\")\n  unlink(\"data/Derived/dgrp2_QC_focal_lines.log\")\n}"
  },
  {
    "objectID": "GWAS.html#run-gwas",
    "href": "GWAS.html#run-gwas",
    "title": "Genome wide analyses",
    "section": "Run GWAS",
    "text": "Run GWAS\n\n\nShow the code\nArya_f_l &lt;- prep_for_e0_GWAS(Arya_2010_f)\nArya_m_l &lt;- prep_for_e0_GWAS(Arya_2010_m)\nArya_f_h &lt;- prep_for_h_GWAS(Arya_2010_f)\nArya_m_h &lt;- prep_for_h_GWAS(Arya_2010_m)\nHuang_f_18_l &lt;- prep_for_e0_GWAS(Huang_2020_f_18)\nHuang_f_18_h &lt;- prep_for_h_GWAS(Huang_2020_f_18)\nHuang_m_18_l &lt;- prep_for_e0_GWAS(Huang_2020_m_18)\nHuang_m_18_h &lt;- prep_for_h_GWAS(Huang_2020_m_18)\nHuang_f_25_l &lt;- prep_for_e0_GWAS(Huang_2020_f_25)\nHuang_f_25_h &lt;- prep_for_h_GWAS(Huang_2020_f_25)\nHuang_m_25_l &lt;- prep_for_e0_GWAS(Huang_2020_m_25)\nHuang_m_25_h &lt;- prep_for_h_GWAS(Huang_2020_m_25)\nHuang_f_28_l &lt;- prep_for_e0_GWAS(Huang_2020_f_28)\nHuang_f_28_h &lt;- prep_for_h_GWAS(Huang_2020_f_28)\nHuang_m_28_l &lt;- prep_for_e0_GWAS(Huang_2020_m_28)\nHuang_m_28_h &lt;- prep_for_h_GWAS(Huang_2020_m_28)\nWilson_f_l &lt;- prep_for_e0_GWAS(Wilson_2020_f)\nWilson_f_h &lt;- prep_for_h_GWAS(Wilson_2020_f)\nDurham_f_l &lt;- prep_for_e0_GWAS(Durham_2014_f)\nDurham_f_h &lt;- prep_for_h_GWAS(Durham_2014_f)\nPatel_f_l &lt;- prep_for_e0_GWAS(Patel_2021_f)\nPatel_f_h &lt;- prep_for_h_GWAS(Patel_2021_f)\n\nresidual_f_l &lt;- prep_for_e0_GWAS(residual_means %&gt;% filter(Sex == \"Female\"))\nresidual_m_l &lt;- prep_for_e0_GWAS(residual_means %&gt;% filter(Sex == \"Male\"))\nresidual_f_h &lt;- prep_for_h_GWAS(residual_means %&gt;% filter(Sex == \"Female\"))\nresidual_m_h &lt;- prep_for_h_GWAS(residual_means %&gt;% filter(Sex == \"Male\"))\n\n# if not already done, run the GWA tests\n\nif(!file.exists(\"data/Derived/GWAS_results/Arya_f_l.tsv.gz\")) {\nrun_GWAS(Arya_f_l)\nrun_GWAS(Arya_m_l)\nrun_GWAS(Arya_f_h)\nrun_GWAS(Arya_m_h)\nrun_GWAS(Huang_f_18_l)\nrun_GWAS(Huang_f_18_h)\nrun_GWAS(Huang_m_18_l)\nrun_GWAS(Huang_m_18_h)\nrun_GWAS(Huang_f_25_l)\nrun_GWAS(Huang_f_25_h)\nrun_GWAS(Huang_m_25_l)\nrun_GWAS(Huang_m_25_h)\nrun_GWAS(Huang_f_28_l)\nrun_GWAS(Huang_f_28_h)\nrun_GWAS(Huang_m_28_l)\nrun_GWAS(Huang_m_28_h)\nrun_GWAS(Wilson_f_l)\nrun_GWAS(Wilson_f_h)\nrun_GWAS(Durham_f_l)\nrun_GWAS(Durham_f_h)\nrun_GWAS(Patel_f_l)\nrun_GWAS(Patel_f_h)\n}\n\n\nAs a point of comparison, we collate the number of significant associations detected by each individual GWAS\n\n\nShow the code\n# load GWAS results\n\n# Life expectancy\n\nArya_f_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Arya_f_l.tsv.gz\") \n  \nHuang_f_18_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Huang_f_18_l.tsv.gz\")\n\nHuang_f_25_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Huang_f_25_l.tsv.gz\") \n\nHuang_f_28_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Huang_f_28_l.tsv.gz\")\n\nWilson_f_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Wilson_f_l.tsv.gz\") \n\nDurham_f_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Durham_f_l.tsv.gz\")\n\nPatel_f_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Patel_f_l.tsv.gz\")\n\nArya_m_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Arya_m_l.tsv.gz\")\n\nHuang_m_18_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Huang_m_18_l.tsv.gz\")\n\nHuang_m_25_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Huang_m_25_l.tsv.gz\")\n\nHuang_m_28_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Huang_m_28_l.tsv.gz\")\n\n# Lifespan equality\n\nArya_f_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Arya_f_h.tsv.gz\")\n  \nHuang_f_18_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Huang_f_18_h.tsv.gz\")\n\nHuang_f_25_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Huang_f_25_h.tsv.gz\") \n\nHuang_f_28_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Huang_f_28_h.tsv.gz\")\n\nWilson_f_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Wilson_f_h.tsv.gz\")\n\nDurham_f_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Durham_f_h.tsv.gz\")\n\nPatel_f_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Patel_f_h.tsv.gz\")\n\nArya_m_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Arya_m_h.tsv.gz\")\n\nHuang_m_18_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Huang_m_18_h.tsv.gz\")\n\nHuang_m_25_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Huang_m_25_h.tsv.gz\")\n\nHuang_m_28_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/Huang_m_28_h.tsv.gz\")\n\n\nTable XX. Genotype to phenotype associations detected by univariate GWAS, for life expectancy. The total row shows the number of unique candidate variants identified across all studies.\n\n\nShow the code\n# filter down tp sig associations\ne0_table &lt;-\nbind_rows(\nArya_f_l_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Arya_f_l_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Arya et al 2010\",\n         Sex = \"Female\",\n         Temperature = \"25\",\n         `Mating status` = \"Virgin\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n  \n  \nHuang_f_18_l_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Huang_f_18_l_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Sex = \"Female\",\n         Temperature = \"18\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nHuang_f_25_l_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Huang_f_25_l_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Sex = \"Female\",\n         Temperature = \"25\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nHuang_f_28_l_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Huang_f_28_l_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Sex = \"Female\",\n         Temperature = \"28\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nWilson_f_l_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Wilson_f_l_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Wilson et al 2020\",\n         Sex = \"Female\",\n         Temperature = \"25\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nDurham_f_l_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Durham_f_l_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Durham et al 2014\",\n         Sex = \"Female\",\n         Temperature = \"25\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nPatel_f_l_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Patel_f_l_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Patel et al 2021\",\n         Sex = \"Female\",\n         Temperature = \"23\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nArya_m_l_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Arya_m_l_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Arya et al 2010\",\n         Sex = \"Male\",\n         Temperature = \"25\",\n         `Mating status` = \"Virgin\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nHuang_m_18_l_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Huang_m_18_l_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Sex = \"Male\",\n         Temperature = \"18\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nHuang_m_25_l_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Huang_m_25_l_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Sex = \"Male\",\n         Temperature = \"25\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nHuang_m_28_l_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Huang_m_28_l_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Sex = \"Male\",\n         Temperature = \"28\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`)\n) \n\n# how many unique variants have been detected?\np_05_SNPs &lt;-\n  bind_rows(\n    \n    Arya_f_l_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Arya_m_l_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Huang_f_18_l_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Huang_f_25_l_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Huang_f_28_l_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Huang_m_18_l_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Huang_m_25_l_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Huang_m_28_l_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Wilson_f_l_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Durham_f_l_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Patel_f_l_GWAS %&gt;% \n      filter(P &lt; 0.00005)\n  ) %&gt;% \n  distinct(SNP) %&gt;% \n  nrow()\n\n\ne0_table %&gt;% \n  add_row(Study = \"Totals\",\n          Sex = \"\",\n          Temperature = \"\",\n          `Mating status` = \"\",\n          `p &lt; 0.05e-05 variants` = p_05_SNPs,\n          `p &lt; 0.05e-08 variants` = sum(e0_table$`p &lt; 0.05e-08 variants`)) %&gt;% \n  kable() %&gt;% \n  kable_styling()\n\n\n\n\n\nStudy\nSex\nTemperature\nMating status\np &lt; 0.05e-05 variants\np &lt; 0.05e-08 variants\n\n\n\n\nArya et al 2010\nFemale\n25\nVirgin\n17\n0\n\n\nHuang et al 2020\nFemale\n18\nMated\n16\n0\n\n\nHuang et al 2020\nFemale\n25\nMated\n18\n0\n\n\nHuang et al 2020\nFemale\n28\nMated\n16\n0\n\n\nWilson et al 2020\nFemale\n25\nMated\n5\n0\n\n\nDurham et al 2014\nFemale\n25\nMated\n15\n0\n\n\nPatel et al 2021\nFemale\n23\nMated\n23\n0\n\n\nArya et al 2010\nMale\n25\nVirgin\n8\n0\n\n\nHuang et al 2020\nMale\n18\nMated\n10\n0\n\n\nHuang et al 2020\nMale\n25\nMated\n16\n0\n\n\nHuang et al 2020\nMale\n28\nMated\n22\n0\n\n\nTotals\n\n\n\n160\n0\n\n\n\n\n\n\n\nTable XX. Genotype to phenotype associations detected by univariate GWAS, for lifespan equality. The total row shows the number of unique candidate variants identified across all studies.\n\n\nShow the code\n# filter down tp sig associations\nh_table &lt;-\nbind_rows(\nArya_f_h_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Arya_f_h_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Arya et al 2010\",\n         Sex = \"Female\",\n         Temperature = \"25\",\n         `Mating status` = \"Virgin\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n  \n  \nHuang_f_18_h_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Huang_f_18_h_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Sex = \"Female\",\n         Temperature = \"18\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nHuang_f_25_h_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Huang_f_25_h_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Sex = \"Female\",\n         Temperature = \"25\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nHuang_f_28_h_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Huang_f_28_h_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Sex = \"Female\",\n         Temperature = \"28\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nWilson_f_h_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Wilson_f_h_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Wilson et al 2020\",\n         Sex = \"Female\",\n         Temperature = \"25\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nDurham_f_h_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Durham_f_h_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Durham et al 2014\",\n         Sex = \"Female\",\n         Temperature = \"25\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nPatel_f_h_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Patel_f_h_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Patel et al 2021\",\n         Sex = \"Female\",\n         Temperature = \"23\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nArya_m_h_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Arya_m_h_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Arya et al 2010\",\n         Sex = \"Male\",\n         Temperature = \"25\",\n         `Mating status` = \"Virgin\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nHuang_m_18_h_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Huang_m_18_h_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Sex = \"Male\",\n         Temperature = \"18\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nHuang_m_25_h_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Huang_m_25_h_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Sex = \"Male\",\n         Temperature = \"25\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nHuang_m_28_h_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(Huang_m_28_h_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Sex = \"Male\",\n         Temperature = \"28\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Sex, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`)\n) \n\n\n# how many unique variants have been detected?\np_05_SNPs_h &lt;-\n  bind_rows(\n    \n    Arya_f_h_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Arya_m_h_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Huang_f_18_h_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Huang_f_25_h_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Huang_f_28_h_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Huang_m_18_h_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Huang_m_25_h_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Huang_m_28_h_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Wilson_f_h_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Durham_f_h_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    Patel_f_h_GWAS %&gt;% \n      filter(P &lt; 0.00005)\n  ) %&gt;% \n  distinct(SNP) %&gt;% \n  nrow()\n\n\nh_table %&gt;% \n  add_row(Study = \"Totals\",\n          Sex = \"\",\n          Temperature = \"\",\n          `Mating status` = \"\",\n          `p &lt; 0.05e-05 variants` = p_05_SNPs_h,\n          `p &lt; 0.05e-08 variants` = sum(h_table$`p &lt; 0.05e-08 variants`)) %&gt;% \n  kable() %&gt;% \n  kable_styling()\n\n\n\n\n\nStudy\nSex\nTemperature\nMating status\np &lt; 0.05e-05 variants\np &lt; 0.05e-08 variants\n\n\n\n\nArya et al 2010\nFemale\n25\nVirgin\n13\n0\n\n\nHuang et al 2020\nFemale\n18\nMated\n5\n0\n\n\nHuang et al 2020\nFemale\n25\nMated\n19\n0\n\n\nHuang et al 2020\nFemale\n28\nMated\n22\n0\n\n\nWilson et al 2020\nFemale\n25\nMated\n21\n0\n\n\nDurham et al 2014\nFemale\n25\nMated\n6\n0\n\n\nPatel et al 2021\nFemale\n23\nMated\n8\n0\n\n\nArya et al 2010\nMale\n25\nVirgin\n19\n0\n\n\nHuang et al 2020\nMale\n18\nMated\n9\n0\n\n\nHuang et al 2020\nMale\n25\nMated\n12\n0\n\n\nHuang et al 2020\nMale\n28\nMated\n15\n0\n\n\nTotals\n\n\n\n144\n0"
  },
  {
    "objectID": "GWAS.html#the-method",
    "href": "GWAS.html#the-method",
    "title": "Genome wide analyses",
    "section": "The method",
    "text": "The method\nThe power to detect variants associated with correlated phenotypes can be increased if a meta-analytic approach is adopted (Zhu et al, 2018). Here, we use the CPASSOC approach developed by Zhou et al (2015), which evaluates the null hypothesis that SNPs are associated with none of the considered traits, weighted by the sample size of each study and adjusted for the trait correlation matrix. The steps to apply CPASSOC are as follows:\n\nEstimate \\(R\\), the trait correlation matrix. In the DGRP, this can be done using SNP data or using line means.\nGWAS each trait separately (see above).\nCollate effect sizes for each trait into a vector \\(\\beta\\), for each SNP.\nUse a Wald test statistic to estimate a vector of p-values, \\(T\\), from the \\(\\beta\\) and \\(\\sigma\\) (which is approximated from the study sample size) estimates for each SNP.\nTest whether \\(\\beta\\) = 0. If the trait data are homogeneous (SNPs are expected to affect all traits in the same direction), use:\n\n\\[S_{Hom} = \\frac{e^T(RW)^{-1}T(e^T(RW)^{-1}T)^T}{e^T(WRW)^{-1}e}\\] where \\(W\\) is a diagonal matrix of weights for the individual test statistics (either the inverse of the variance or simply the sample size).\n\nIf there is heterogeneity between trait measures (i.e. it is a reasonable expectation that SNPs could affect some traits in one direction and others in the opposing direction), \\(S_{Hom}\\) is not appropriate. The ideal test statistic in this case would only include the cohorts and traits with a true contribution to the association of a genetic variant. To implement this, the value \\(\\tau\\) is used as a threshold, below which traits are not included in the test statistic. This statistic, \\(S_{Het}\\) can be viewed as the maximum of the weighted sum of trait-specific test statistics satisfying different thresholds. To calculate \\(S_{Het}\\) first find,\n\n\\[S_{\\tau} = \\frac{e^T(R(\\tau)W(\\tau))^{-1}T(\\tau)(e^T(R(\\tau)W(\\tau))^{-1}T(\\tau))^T}{e^TW(\\tau)^{-1}R(\\tau)^{-1}W(\\tau)^{-1}e}\\] When \\(\\tau\\) is large, \\(S(\\tau)\\) can be undefined if the test statistic falls below \\(\\tau\\) for all cohorts. In this case \\(S(\\tau) = 0\\). Our test statistic is then\n\\[\\displaystyle S_{Het} =  \\max_{\\tau \\gt 0} S(\\tau)\\] To generate p-values, \\(S_{Het}\\) is then compared with a gamma distribution of test-statistics.\nAnyway, I’ve only included that for the mathematically inclined. Code to implement both statistics in R can be downloaded here, and is implemented below."
  },
  {
    "objectID": "GWAS.html#the-functions",
    "href": "GWAS.html#the-functions",
    "title": "Genome wide analyses",
    "section": "The functions",
    "text": "The functions\nThese are directly loaded from here\n\n\nShow the code\nrequire(compiler)\nenableJIT(4)\n\n\n[1] 3\n\n\nShow the code\nNon_Trucated_TestScore &lt;- function(X, SampleSize, CorrMatrix)\n{\n  Wi = matrix(SampleSize, nrow = 1);\n  sumW = sqrt(sum(Wi^2));\n  W = Wi / sumW;\n  \n  Sigma = ginv(CorrMatrix);\n  XX = apply(X, 1, function(x) {\n    x1 &lt;- matrix(x, ncol = length(x), nrow = 1);\n    T = W %*% Sigma %*% t(x1);\n    T = (T*T) / (W %*% Sigma %*% t(W));\n    return(T[1,1]);\n  }\n  );\n  return(XX);\n}\nSHom &lt;- cmpfun(Non_Trucated_TestScore);\n\nTrucated_TestScore &lt;- function(X, SampleSize, CorrMatrix, correct = 1, startCutoff = 0, endCutoff = 1, CutoffStep = 0.05, isAllpossible = T)\n{\n  N = dim(X)[2];\n  \n  Wi = matrix(SampleSize, nrow = 1);\n  sumW = sqrt(sum(Wi^2));\n  W = Wi / sumW;\n  \n  XX = apply(X, 1, function(x) {\n    TTT = -1;\n    \n    if (isAllpossible == T ) {\n      cutoff = sort(unique(abs(x)));      ## it will filter out any of them.\n    } else {\n      cutoff = seq(startCutoff, endCutoff, CutoffStep);\n    }\n    \n    \n    for (threshold in cutoff) {\n      x1 = x;\n      index = which(abs(x1) &lt; threshold);\n      \n      if (length(index) == N) break;\n      \n      A = CorrMatrix;\n      \n      W1 = W;\n      if (length(index) !=0 ) {\n        x1 = x1[-index];\n        A  = A[-index, -index];   ## update the matrix\n        W1 = W[-index];\n      }\n      \n      if (correct == 1)\n      {\n        index = which(x1 &lt; 0);\n        if (length(index) != 0) {\n          W1[index] = -W1[index];    ## update the sign\n        }\n      }\n      \n      A = ginv(A);\n      x1 = matrix(x1, nrow = 1);\n      W1 = matrix(W1, nrow = 1);\n      T = W1 %*% A %*% t(x1);\n      T = (T*T) / (W1 %*% A %*% t(W1));\n      \n      if (TTT &lt; T[1,1]) TTT = T[1,1];\n    }\n    return(TTT);\n  }\n  );\n  return(XX);\n}\nSHet &lt;- cmpfun(Trucated_TestScore);\n\nEstimateGamma &lt;- function (N = 1E6, SampleSize, CorrMatrix, correct = 1, startCutoff = 0, endCutoff = 1, CutoffStep = 0.05, isAllpossible = T) {\n  \n  Wi = matrix(SampleSize, nrow = 1);\n  sumW = sqrt(sum(Wi^2));\n  W = Wi / sumW;\n  \n  Permutation = mvrnorm(n = N, mu = c(rep(0, length(SampleSize))), Sigma = CorrMatrix, tol = 1e-8, empirical = F);\n  \n  Stat =  Trucated_TestScore(X = Permutation, SampleSize = SampleSize, CorrMatrix = CorrMatrix,\n                             correct = correct, startCutoff = startCutoff, endCutoff = endCutoff,\n                             CutoffStep = CutoffStep, isAllpossible = isAllpossible);\n  a = min(Stat)*3/4\n  ex3 = mean(Stat*Stat*Stat)\n  V =   var(Stat);\n  \n  for (i in 1:100){\n    E = mean(Stat)-a;\n    k = E^2/V\n    theta = V/E\n    a = (-3*k*(k+1)*theta**2+sqrt(9*k**2*(k+1)**2*theta**4-12*k*theta*(k*(k+1)*(k+2)*theta**3-ex3)))/6/k/theta\n  }\n  \n  para = c(k,theta,a);\n  return(para);\n}\n\n\n\nEmpDist &lt;- function (N = 1E6, SampleSize, CorrMatrix, correct = 1, startCutoff = 0, endCutoff = 1, CutoffStep = 0.05, isAllpossible = T) {\n  \n  Wi = matrix(SampleSize, nrow = 1);\n  sumW = sqrt(sum(Wi^2));\n  W = Wi / sumW;\n  \n  Permutation = mvrnorm(n = N, mu = c(rep(0, length(SampleSize))), Sigma = CorrMatrix, tol = 1e-8, empirical = F);\n  \n  Stat =  Trucated_TestScore(X = Permutation, SampleSize = SampleSize, CorrMatrix = CorrMatrix, correct = correct, startCutoff = startCutoff, endCutoff = endCutoff, CutoffStep = CutoffStep, isAllpossible = isAllpossible);\n  \n  \n  return(Stat);\n}"
  },
  {
    "objectID": "GWAS.html#generate-the-genetic-correlation-matrix",
    "href": "GWAS.html#generate-the-genetic-correlation-matrix",
    "title": "Genome wide analyses",
    "section": "Generate the genetic correlation matrix",
    "text": "Generate the genetic correlation matrix\nWe calculate the genetic correlations between traits using both the line mean and SNP effect size comparisons. We use the SNP correlations following Zhu et al (2015) and show these in the below plots. Note that while the two approaches produce results that have a strong positive correlation, there are small differences that will affect downstream analyses.\n\n\nShow the code\n# use the BETA coefficients to build the SNP correlation matrix\n\nSNP_data_e0 &lt;-\n  bind_rows(\n    Arya_f_l_GWAS %&gt;% \n      mutate(Study = \"Arya_2010\", Sex = \"Female\", Temperature = 25),\n    Huang_f_18_l_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Female\", Temperature= 18),\n    Huang_f_25_l_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Female\", Temperature= 25),\n    Huang_f_28_l_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Female\", Temperature= 28),\n    Wilson_f_l_GWAS %&gt;% \n      mutate(Study= \"Wilson_2020\", Sex= \"Female\", Temperature= 25),\n    Durham_f_l_GWAS %&gt;% \n      mutate(Study= \"Durham_2014\", Sex= \"Female\", Temperature= 25),\n    Patel_f_l_GWAS %&gt;% \n      mutate(Study= \"Patel_2021\", Sex= \"Female\", Temperature= 23),\n    Arya_m_l_GWAS %&gt;% \n      mutate(Study= \"Arya_2010\", Sex= \"Male\", Temperature= 25),\n    Huang_m_18_l_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Male\", Temperature= 18),\n    Huang_m_25_l_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Male\", Temperature = 25),\n    Huang_m_28_l_GWAS %&gt;% \n      mutate(Study = \"Huang_2020\", Sex = \"Male\", Temperature = 28)) %&gt;% \n  dplyr::select(SNP, BETA, Study, Sex, Temperature) %&gt;% \n  pivot_wider(values_from = BETA, names_from = c(Study, Sex, Temperature)) %&gt;% \n  dplyr::select(-SNP) %&gt;% \n  rename(Arya_f_25 = Arya_2010_Female_25,\n         Huang_f_18 = Huang_2020_Female_18,\n         Huang_f_25 = Huang_2020_Female_25,\n         Huang_f_28 = Huang_2020_Female_28,\n         Wilson_f_25 = Wilson_2020_Female_25,\n         Durham_f_25 = Durham_2014_Female_25,\n         Patel_f_23 = Patel_2021_Female_23,\n         Arya_m_25 = Arya_2010_Male_25,\n         Huang_m_18 = Huang_2020_Male_18,\n         Huang_m_25 = Huang_2020_Male_25,\n         Huang_m_28 = Huang_2020_Male_28)\n\nSNP_data_h &lt;-\n  bind_rows(\n    Arya_f_h_GWAS %&gt;% \n      mutate(Study = \"Arya_2010\", Sex = \"Female\", Temperature = 25),\n    Huang_f_18_h_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Female\", Temperature= 18),\n    Huang_f_25_h_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Female\", Temperature= 25),\n    Huang_f_28_h_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Female\", Temperature= 28),\n    Wilson_f_h_GWAS %&gt;% \n      mutate(Study= \"Wilson_2020\", Sex= \"Female\", Temperature= 25),\n    Durham_f_h_GWAS %&gt;% \n      mutate(Study= \"Durham_2014\", Sex= \"Female\", Temperature= 25),\n    Patel_f_h_GWAS %&gt;% \n      mutate(Study= \"Patel_2021\", Sex= \"Female\", Temperature= 23),\n    Arya_m_h_GWAS %&gt;% \n      mutate(Study= \"Arya_2010\", Sex= \"Male\", Temperature= 25),\n    Huang_m_18_h_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Male\", Temperature= 18),\n    Huang_m_25_h_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Male\", Temperature = 25),\n    Huang_m_28_h_GWAS %&gt;% \n      mutate(Study = \"Huang_2020\", Sex = \"Male\", Temperature = 28)) %&gt;% \n  dplyr::select(SNP, BETA, Study, Sex, Temperature) %&gt;% \n  pivot_wider(values_from = BETA, names_from = c(Study, Sex, Temperature)) %&gt;% \n  dplyr::select(-SNP) %&gt;%\n  rename(Arya_f_25 = Arya_2010_Female_25,\n         Huang_f_18 = Huang_2020_Female_18,\n         Huang_f_25 = Huang_2020_Female_25,\n         Huang_f_28 = Huang_2020_Female_28,\n         Wilson_f_25 = Wilson_2020_Female_25,\n         Durham_f_25 = Durham_2014_Female_25,\n         Patel_f_23 = Patel_2021_Female_23,\n         Arya_m_25 = Arya_2010_Male_25,\n         Huang_m_18 = Huang_2020_Male_18,\n         Huang_m_25 = Huang_2020_Male_25,\n         Huang_m_28 = Huang_2020_Male_28)\n  \n\nSNP_e0_corr_matrix &lt;- cor(SNP_data_e0, use = \"pairwise.complete.obs\", method = \"spearman\")\nSNP_h_corr_matrix &lt;- cor(SNP_data_h, use = \"pairwise.complete.obs\", method = \"spearman\")\n\n\nline_data &lt;-\n  bind_rows(Arya_2010_f,\n            Huang_2020_f_18,\n            Huang_2020_f_25,\n            Huang_2020_f_28,\n            Wilson_2020_f,\n            Durham_2014_f,\n            Patel_2021_f,\n            Arya_2010_m,\n            Huang_2020_m_18,\n            Huang_2020_m_25,\n            Huang_2020_m_28) %&gt;% \n  dplyr::select(line, Study, Sex, Temperature, e0, h) %&gt;% \n  pivot_wider(values_from = c(e0, h), names_from = c(Study, Sex, Temperature)) \n\nline_data_e0 &lt;-\n  line_data %&gt;% \n  dplyr::select(contains(\"e0\")) %&gt;% \n  rename(Arya_f_25 = e0_Arya_2010_Female_25,\n         Huang_f_18 = e0_Huang_2020_Female_18,\n         Huang_f_25 =  e0_Huang_2020_Female_25,\n         Huang_f_28 = e0_Huang_2020_Female_28,\n         Wilson_f_25 = e0_Wilson_2020_Female_25,\n         Durham_f_25 = e0_Durham_2014_Female_25,\n         Patel_f_23 = e0_Patel_2021_Female_23,\n         Arya_m_25 = e0_Arya_2010_Male_25,\n         Huang_m_18 = e0_Huang_2020_Male_18,\n         Huang_m_25 = e0_Huang_2020_Male_25,\n         Huang_m_28 = e0_Huang_2020_Male_28)\n\nline_data_h &lt;-\n  line_data %&gt;% \n  dplyr::select(!contains(\"e0\"), -line) %&gt;% \n  rename(Arya_f_25 = h_Arya_2010_Female_25,\n         Huang_f_18 = h_Huang_2020_Female_18,\n         Huang_f_25 =  h_Huang_2020_Female_25,\n         Huang_f_28 = h_Huang_2020_Female_28,\n         Wilson_f_25 = h_Wilson_2020_Female_25,\n         Durham_f_25 = h_Durham_2014_Female_25,\n         Patel_f_23 = h_Patel_2021_Female_23,\n         Arya_m_25 = h_Arya_2010_Male_25,\n         Huang_m_18 = h_Huang_2020_Male_18,\n         Huang_m_25 = h_Huang_2020_Male_25,\n         Huang_m_28 = h_Huang_2020_Male_28)\n\nline_e0_corr_matrix &lt;- cor(line_data_e0, use = \"pairwise.complete.obs\", method = \"spearman\")\nline_h_corr_matrix &lt;- cor(line_data_h, use = \"pairwise.complete.obs\", method = \"spearman\")\n\n\nLet’s visualise the genetic correlation between lifespan measures. First for life expectancy:\n\n\nShow the code\nbreaksList &lt;- seq(-1, 1, by = 0.02)\n\n#pheatmap(line_e0_corr_matrix, breaks = breaksList, \n#main = \"\", legend_labels = c(\"-1\", \"-0.5\", \"0\", \"0.5\", \"Genetic correlation\\n\"),\n#color = colorRampPalette(rev(met.brewer(\"Benedictus\", direction = 1)))(length(breaksList)),\n#legend = TRUE, cutree_rows = 3, cutree_cols = 3, angle_col = 45, border_color = \"white\")\n\npheatmap(SNP_e0_corr_matrix, breaks = breaksList, \nmain = \"\", legend_labels = c(\"-1\", \"-0.5\", \"0\", \"0.5\", \"Genetic correlation\\n\"),\ncolor = colorRampPalette(rev(met.brewer(\"Benedictus\", direction = 1)))(length(breaksList)),\nlegend = TRUE, cutree_rows = 3, cutree_cols = 3, angle_col = 45, border_color = \"white\")\n\n\n\n\n\nNow for lifespan equality\n\n\nShow the code\n#pheatmap(all_h_corr_matrix, breaks = breaksList, \n#main = \"\", legend_labels = c(\"-1\", \"-0.5\", \"0\", \"0.5\", \"Genetic correlation\\n\"),\n#color = colorRampPalette(rev(met.brewer(\"Benedictus\", direction = 1)))(length(breaksList)),\n#legend = TRUE, cutree_rows = 3, cutree_cols = 3, angle_col = 45, border_color = \"white\")\n\npheatmap(SNP_h_corr_matrix, breaks = breaksList, \nmain = \"\", legend_labels = c(\"-1\", \"-0.5\", \"0\", \"0.5\", \"Genetic correlation\\n\"),\ncolor = colorRampPalette(rev(met.brewer(\"Benedictus\", direction = 1)))(length(breaksList)),\nlegend = TRUE, cutree_rows = 3, cutree_cols = 3, angle_col = 45, border_color = \"white\")"
  },
  {
    "objectID": "GWAS.html#calculate-meta-analytic-test-statistics",
    "href": "GWAS.html#calculate-meta-analytic-test-statistics",
    "title": "Genome wide analyses",
    "section": "Calculate meta-analytic test statistics",
    "text": "Calculate meta-analytic test statistics\n\ne0, sexes combined\nThe purpose of this meta-analysis is to search for SNPs that have some effect on ageing, expressed in many different contexts (sexes, temperatures and mating status’).\nTo conduct CPASSOC for a given SNP, we need a summary statistic from each GWAS. A different number of lines were included in each GWAS, which can cause small differences in the number of SNPs assessed. We therefore prune the list of SNPs to those included in all univariate analyses. After pruning (and previous pruning to remove SNPs in linkage disequilibrium), 220,582 SNPs remain.\n\n\nShow the code\nArya_f_l_T &lt;- Arya_f_l_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Arya_f = T)\n  \nHuang_f_18_l_T &lt;- Huang_f_18_l_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_f_18 = T)\n\nHuang_f_25_l_T &lt;- Huang_f_25_l_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_f_25 = T)\n\nHuang_f_28_l_T &lt;- Huang_f_28_l_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_f_28 = T)\n\nWilson_f_l_T &lt;- Wilson_f_l_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;%  \n  rename(Wilson_f_25  = T)\n\nDurham_f_l_T &lt;- Durham_f_l_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;%  \n  rename(Durham_f_25 = T)\n\nPatel_f_l_T &lt;- Patel_f_l_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;%  \n  rename(Patel_f_23 = T)\n\nArya_m_l_T &lt;- Arya_m_l_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Arya_m = T)\n\nHuang_m_18_l_T &lt;- Huang_m_18_l_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_m_18  = T)\n\nHuang_m_25_l_T &lt;- Huang_m_25_l_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_m_25 = T)\n\nHuang_m_28_l_T &lt;- Huang_m_28_l_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_m_28  = T)\n\n\n\nall_e0_effect_sizes &lt;-\n  Arya_f_l_T %&gt;%\n  inner_join(Huang_f_18_l_T, by = \"SNP\") %&gt;%\n  inner_join(Huang_f_25_l_T, by = \"SNP\") %&gt;%\n  inner_join(Huang_f_28_l_T, by = \"SNP\") %&gt;% \n  inner_join(Wilson_f_l_T, by = \"SNP\") %&gt;% \n  inner_join(Durham_f_l_T, by = \"SNP\") %&gt;% \n  inner_join(Patel_f_l_T, by = \"SNP\") %&gt;% \n  inner_join(Arya_m_l_T, by = \"SNP\") %&gt;% \n  inner_join(Huang_m_18_l_T, by = \"SNP\") %&gt;% \n  inner_join(Huang_m_25_l_T, by = \"SNP\") %&gt;%\n  inner_join(Huang_m_28_l_T, by = \"SNP\")\n\n\nall_e0_effect_sizes_values &lt;-\n  all_e0_effect_sizes %&gt;% \n  dplyr::select(2:12)\n\nSample_size_all &lt;- c(165, 183, 186, 177, 161, 189, 193, 165, 183, 186, 177) \n\nif(!file.exists(\"data/Derived/GWAS_results/all_e0_meta_results.csv\")) {\n\n# run the homogeneous effect meta-analysis\n\nS_hom &lt;- SHom(all_e0_effect_sizes_values, Sample_size_all, SNP_e0_corr_matrix)\n\n# calculate meta-p-values and bind the two together with the SNP names\n\np_S_hom &lt;- pchisq(S_hom, df = 1, ncp = 0, lower.tail = F) %&gt;% \n  as_tibble() %&gt;% \n  bind_cols(S_hom) %&gt;% \n  rename(meta_p_hom = value, \n         S_hom = ...2)\n\n# Calculate S_het, an extension of S_hom that improves power when the genetic effect sizes vary for different traits (e.g. if a SNP has a sex or enviornment opposite effect on lifespan)\n\n# estimate parameters of gamma distribution\n\npara &lt;- EstimateGamma(N = 1E4, Sample_size_all, SNP_e0_corr_matrix);\n\nS_het &lt;- SHet(all_e0_effect_sizes_values, Sample_size_all, SNP_e0_corr_matrix)\n\n# obtain P-values of S_Het using the estimated gamma parameters\n  \np_S_het &lt;- pgamma(q = S_het-para[3], shape = para[1], scale = para[2], lower.tail = F) %&gt;% \n  as_tibble() %&gt;% \n  bind_cols(S_het) %&gt;% \n  rename(meta_p_het = value, \n         S_het = ...2)\n\n\nall_e0_meta_results &lt;- \n  all_e0_effect_sizes %&gt;% \n  bind_cols(p_S_hom,\n            p_S_het) # add the unadjusted p values\n\nwrite_csv(all_e0_meta_results, \"data/Derived/GWAS_results/all_e0_meta_results.csv\")\n\n} else all_e0_meta_results &lt;- read_csv(\"data/Derived/GWAS_results/all_e0_meta_results.csv\")\n\n\n\n\nH sexes combined\n\n\nShow the code\nArya_f_h_T &lt;- Arya_f_h_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Arya_f = T)\n  \nHuang_f_18_h_T &lt;- Huang_f_18_h_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_f_18 = T)\n\nHuang_f_25_h_T &lt;- Huang_f_25_h_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_f_25 = T)\n\nHuang_f_28_h_T &lt;- Huang_f_28_h_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_f_28 = T)\n\nWilson_f_h_T &lt;- Wilson_f_h_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;%  \n  rename(Wilson_f_25  = T)\n\nDurham_f_h_T &lt;- Durham_f_h_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;%  \n  rename(Durham_f_25 = T)\n\nPatel_f_h_T &lt;- Patel_f_h_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;%  \n  rename(Patel_f_23 = T)\n\nArya_m_h_T &lt;- Arya_m_h_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Arya_m = T)\n\nHuang_m_18_h_T &lt;- Huang_m_18_h_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_m_18  = T)\n\nHuang_m_25_h_T &lt;- Huang_m_25_h_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_m_25 = T)\n\nHuang_m_28_h_T &lt;- Huang_m_28_h_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_m_28  = T)\n\n\nall_h_effect_sizes &lt;-\n  Arya_f_h_T %&gt;%\n  inner_join(Huang_f_18_h_T, by = \"SNP\") %&gt;%\n  inner_join(Huang_f_25_h_T, by = \"SNP\") %&gt;%\n  inner_join(Huang_f_28_h_T, by = \"SNP\") %&gt;% \n  inner_join(Wilson_f_h_T, by = \"SNP\") %&gt;% \n  inner_join(Durham_f_h_T, by = \"SNP\") %&gt;% \n  inner_join(Patel_f_h_T, by = \"SNP\") %&gt;% \n  inner_join(Arya_m_h_T, by = \"SNP\") %&gt;% \n  inner_join(Huang_m_18_h_T, by = \"SNP\") %&gt;% \n  inner_join(Huang_m_25_h_T, by = \"SNP\") %&gt;%\n  inner_join(Huang_m_28_h_T, by = \"SNP\") \n  \n\nall_h_effect_sizes_values &lt;-\n  all_h_effect_sizes %&gt;% \n  dplyr::select(2:12)\n\nif(!file.exists(\"data/Derived/GWAS_results/all_h_meta_results.csv\")) {\n\nS_hom &lt;- SHom(all_h_effect_sizes_values, Sample_size_all, SNP_h_corr_matrix)\n\n# calculate meta-p-values and bind the two together with the SNP names\n\np_S_hom &lt;- pchisq(S_hom, df = 1, ncp = 0, lower.tail = F) %&gt;% \n  as_tibble() %&gt;% \n  bind_cols(S_hom) %&gt;% \n  rename(meta_p_hom = value, \n         S_hom = ...2)\n\n# Calculate S_het, an extension of S_hom that improves power when the genetic effect sizes vary for different traits (probably not such a problem here given all traits we investigate are some version of life expectancy)\n\n# estimate parameters of gamma distribution\n\npara &lt;- EstimateGamma(N = 1E4, Sample_size_all, SNP_h_corr_matrix);\n\nS_het &lt;- SHet(all_h_effect_sizes_values, Sample_size_all, SNP_h_corr_matrix)\n\n# obtain P-values of S_Het using the estimated gamma parameters\n  \np_S_het &lt;- pgamma(q = S_het-para[3], shape = para[1], scale = para[2], lower.tail = F) %&gt;% \n  as_tibble() %&gt;% \n  bind_cols(S_het) %&gt;% \n  rename(meta_p_het = value, \n         S_het = ...2)\n\n\nall_h_meta_results &lt;- \n  all_h_effect_sizes %&gt;% \n  bind_cols(p_S_hom,\n            p_S_het) # add the unadjusted p values\n\nwrite_csv(all_h_meta_results, \"data/Derived/GWAS_results/all_h_meta_results.csv\")\n} else all_h_meta_results &lt;- read_csv(\"data/Derived/GWAS_results/all_h_meta_results.csv\")"
  },
  {
    "objectID": "GWAS.html#plot-the-results",
    "href": "GWAS.html#plot-the-results",
    "title": "Genome wide analyses",
    "section": "Plot the results",
    "text": "Plot the results\nWe combine GWAS summary statistics calculated from lifespan data measured across different contexts. It’s possible that some SNPs have G x E interactions that would lead to a heterogeneous effect across phenotypes. We therefore utilise the S_het calculated p-values.\nFirst lets show the effect of CPASSOC on the number of variants found to be associated with life expectancy and lifespan equality.\n\n\nShow the code\ntibble(Analysis = c(\"CPASSOC\", \"Univariate\", \"CPASSOC\", \"Univariate\"),\n       Trait = c(\"Life expectancy\", \"Life expectancy\", \"Lifespan equality\", \"Lifespan equality\"),\n       `p &lt; 0.05e-05 variants` = c(sum(all_e0_meta_results$meta_p_het &lt; 0.00005),\n                                   p_05_SNPs,\n                                   sum(all_h_meta_results$meta_p_het &lt; 0.00005),\n                                   p_05_SNPs_h),\n       `p &lt; 0.05e-08 variants` = c(sum(all_e0_meta_results$meta_p_het &lt; 0.00000005),\n                                   sum(e0_table$`p &lt; 0.05e-08 variants`),\n                                   sum(all_h_meta_results$meta_p_het &lt; 0.00000005),\n                                   sum(h_table$`p &lt; 0.05e-08 variants`)))  %&gt;% \n  kable() %&gt;% \n  kable_styling()\n\n\n\n\n\nAnalysis\nTrait\np &lt; 0.05e-05 variants\np &lt; 0.05e-08 variants\n\n\n\n\nCPASSOC\nLife expectancy\n325\n66\n\n\nUnivariate\nLife expectancy\n160\n0\n\n\nCPASSOC\nLifespan equality\n114\n11\n\n\nUnivariate\nLifespan equality\n144\n0\n\n\n\n\n\n\n\nNow lets build some ‘Manhattan plots’ to show where these significant associations can be found:\n\n\nShow the code\ncommon_SNPs &lt;- \n  all_e0_meta_results %&gt;% filter(meta_p_het &lt; 0.00000005) %&gt;% \n  inner_join(all_h_meta_results %&gt;% filter(meta_p_het &lt; 0.00000005), by = \"SNP\") %&gt;% \n  mutate(common_SNP = \"YES\") %&gt;% \n  dplyr::select(SNP, common_SNP)\n\ne0_results &lt;- \n  all_e0_meta_results %&gt;% \n  dplyr::select(SNP, meta_p_hom, meta_p_het) %&gt;% \n  rename(P = meta_p_het) %&gt;% \n  left_join(common_SNPs) %&gt;% \n  mutate(common_SNP = if_else(is.na(common_SNP), \"NO\", common_SNP))\n  \n\nh_results &lt;- \n  all_h_meta_results %&gt;% \n  dplyr::select(SNP, meta_p_hom, meta_p_het) %&gt;% \n  rename(P = meta_p_het) %&gt;% \n  left_join(common_SNPs) %&gt;% \n  mutate(common_SNP = if_else(is.na(common_SNP), \"NO\", common_SNP))\n\n# plot the results using the manhattan plot custom function we defined earlier\n\ne0_het_plot &lt;- build_manhattan_plot(e0_results) +\n  labs(title = \"Life expectancy\") +\n  theme(plot.title = element_text(size = 20, hjust = 0.5)) +\n  coord_cartesian(ylim = c(0, 20))\n\nh_het_plot &lt;- build_manhattan_plot(h_results) +\n  labs(title = \"Lifespan equality\") +\n  theme(plot.title = element_text(size = 20, hjust = 0.5)) +\n  coord_cartesian(ylim = c(0, 20))\n\n\ne0_het_plot + h_het_plot\n\n\n\n\n\nPlot the univariate effect sizes for each of the SNPs associated with life expectancy / lifespan equality at the genome-wide significance threshold (p &lt; \\(0.05^{-8}\\)) after CPASSOC.\nLife expectancy\n\n\nShow the code\nSNP_heatmap_e0 &lt;-\n  all_e0_meta_results %&gt;% filter(meta_p_het &lt; 0.00000005) %&gt;% \n  arrange(meta_p_het) %&gt;% dplyr::select(1:12) \n\nrow_name &lt;- SNP_heatmap_e0$SNP\nSNP_heatmap_e0 &lt;- SNP_heatmap_e0 %&gt;% dplyr::select(-SNP) %&gt;% as.matrix()\nrownames(SNP_heatmap_e0) &lt;- row_name\n\nbreaksList &lt;- seq(-5, 5, by = 0.1)\n\nannotation_SNPs &lt;- \n  all_e0_meta_results %&gt;% filter(meta_p_het &lt; 0.00000005) %&gt;% dplyr::select(SNP) %&gt;% \n  mutate(Chromosome = case_when(str_detect(SNP, \"2L\") ~ \"2L\",\n                                str_detect(SNP, \"2R\") ~ \"2R\",\n                                str_detect(SNP, \"3L\") ~ \"3L\",\n                                str_detect(SNP, \"3R\") ~ \"3R\",\n                                str_detect(SNP, \"X\") ~ \"X\"))\n\nannotation_studies &lt;- \n  tibble(Study = c(\"Arya_f\",\n                   \"Huang_f_18\",\n                   \"Huang_f_25\",\n                   \"Huang_f_28\",\n                   \"Wilson_f_25\",\n                   \"Durham_f_25\",\n                   \"Patel_f_23\",\n                   \"Arya_m\",\n                   \"Huang_m_18\",\n                   \"Huang_m_25\",\n                   \"Huang_m_28\"),\n         Temperature = c(\"25\",\n                         \"18\",\n                         \"25\",\n                         \"28\",\n                         \"25\",\n                         \"25\",\n                         \"23\",\n                         \"25\",\n                         \"18\",\n                         \"25\",\n                         \"28\")) %&gt;% \n  mutate(Sex = case_when(str_detect(Study, \"_f\") ~ \"Female\",\n                         .default = \"Male\"),\n         Mating  = case_when(str_detect(Study, \"Arya\") ~ \"NO\",\n                             str_detect(Study, \"Huang\") ~ \"Throughout life\",\n                             str_detect(Study, \"Wilson\") ~ \"Early life\",\n                             str_detect(Study, \"Durham\") ~ \"Throughout life\",\n                             str_detect(Study, \"Patel\") ~ \"Early life\"),\n         Author = str_extract(Study, \".*(?=\\\\_)\"),\n         Author = str_remove(Author, \"_f\"),\n         Author = str_remove(Author, \"_m\"))\n\n\n# create a study annotation column, need this to be a data.frame rather than a tibble for some reason \n\nStudy_details &lt;- annotation_studies %&gt;%\n  as.data.frame() %&gt;% \n  dplyr::select(Study, Temperature, Mating)\n\nmy_categories &lt;- data.frame(row.names = Study_details[, 1], Temperature = Study_details[, 2],\n                            Mating = Study_details[, 3])\n\nmy_colors &lt;- list(Temperature = c(\"18\" = \"#7bbcd5\", # sailboat colours from pnw\n                                  \"23\" = \"#d0e2af\",\n                                  \"25\" = \"#f5db99\",\n                                  \"28\" = \"#e89c81\"),\n                  Mating = c(\"NO\" = \"#f8e3d1\", # Shuksan from pnw\n                             \"Early life\" = \"#d7b1c5\",\n                             \"Throughout life\" = \"#ac8eab\"),\n                  Chromosome = c(\"2L\" = \"#d8aedd\", # lake colours from pnw\n                                 \"2R\" = \"#cb74ad\",\n                                 \"3L\" = \"#11c2b5\",\n                                 \"3R\" = \"#72e1e1\",\n                                 \"X\" = \"#fbcc74\"))\n# create a SNP annotation column\n\nSNP_details &lt;- annotation_SNPs %&gt;%\n  as.data.frame()\n\nmy_SNP_categories &lt;- data.frame(row.names = SNP_details[, 1], Chromosome = SNP_details[, 2])\n\nmy_col_names &lt;- c(\"Arya et al females\", \"Huang et al females\", \"Huang et al females\",\n                  \"Huang et al females\", \"Wilson et al females\", \"Durham et al females\",\n                  \"Patel et al females\", \"Arya et al males\", \"Huang et al males\", \"Huang et al males\",\n                  \"Huang et al males\")\n\n\npheatmap(SNP_heatmap_e0, breaks = breaksList, \n         main = \"\", legend_labels = c(\"-1\", \"-0.5\", \"0\", \"0.5\", \"Genetic correlation\\n\"),\n         color = colorRampPalette(rev(met.brewer(\"Benedictus\", direction = 1)))(length(breaksList)),\n         legend = TRUE, cutree_rows = 4, cutree_cols = 3, \n         angle_col = 45, border_color = \"white\",\n         annotation_col = my_categories, annotation_colors = my_colors, annotation_row = my_SNP_categories,\n         fontsize = 8, labels_col = my_col_names)\n\n\n\n\n\nLifespan inequality\n\n\nShow the code\nSNP_heatmap_h &lt;-\n  all_h_meta_results %&gt;% filter(meta_p_het &lt; 0.00000005) %&gt;% \n  arrange(meta_p_het) %&gt;% dplyr::select(1:12) \n\nrow_name &lt;- SNP_heatmap_h$SNP\nSNP_heatmap_h &lt;- SNP_heatmap_h %&gt;% dplyr::select(-SNP) %&gt;% as.matrix()\nrownames(SNP_heatmap_h) = row_name\n\nbreaksList &lt;- seq(-5, 5, by = 0.1)\n\nannotation_SNPs_h &lt;- \n  all_h_meta_results %&gt;% filter(meta_p_het &lt; 0.00000005) %&gt;% dplyr::select(SNP) %&gt;% \n  mutate(Chromosome = case_when(str_detect(SNP, \"2L\") ~ \"2L\",\n                                str_detect(SNP, \"2R\") ~ \"2R\",\n                                str_detect(SNP, \"3L\") ~ \"3L\",\n                                str_detect(SNP, \"3R\") ~ \"3R\",\n                                str_detect(SNP, \"X\") ~ \"X\"))\n\n\n# create a SNP annotation column\n\nSNP_details_h &lt;- annotation_SNPs_h %&gt;%\n  as.data.frame()\n\nmy_SNP_categories_h &lt;- data.frame(row.names = SNP_details_h[, 1], Chromosome = SNP_details_h[, 2])\n\npheatmap(SNP_heatmap_h, breaks = breaksList, \n         main = \"\", legend_labels = c(\"-1\", \"-0.5\", \"0\", \"0.5\", \"Genetic correlation\\n\"),\n         color = colorRampPalette(rev(met.brewer(\"Benedictus\", direction = 1)))(length(breaksList)),\n         legend = TRUE, cutree_rows = 3, cutree_cols = 4, angle_col = 45, border_color = \"white\",\n         annotation_col = my_categories, annotation_colors = my_colors, \n         annotation_row = my_SNP_categories_h,\n         fontsize = 8, labels_col = my_col_names)"
  },
  {
    "objectID": "GWAS.html#the-intersex-genetic-correlation",
    "href": "GWAS.html#the-intersex-genetic-correlation",
    "title": "Genome wide analyses",
    "section": "The intersex genetic correlation",
    "text": "The intersex genetic correlation\nLets take a quick look at the intersex-genetic correlations for our metrics in each relevant measurement condition.\n\n\nShow the code\nArya_two_sexes_SNPS &lt;-\n  left_join(\n    Arya_f_l_GWAS %&gt;% \n      dplyr::select(1:2) %&gt;% \n      rename(Female_e0_effect = BETA), \n    \n    Arya_m_l_GWAS %&gt;% \n      dplyr::select(1:2) %&gt;% \n      rename(Male_e0_effect = BETA)\n  ) %&gt;% \n  left_join(Arya_f_h_GWAS %&gt;% \n              dplyr::select(1:2) %&gt;% \n              rename(Female_h_effect = BETA)) %&gt;% \n  left_join(Arya_m_h_GWAS %&gt;% \n              dplyr::select(1:2) %&gt;% \n              rename(Male_h_effect = BETA))\n\nHuang_18_two_sexes_SNPS &lt;-\n  left_join(\n    Huang_f_18_l_GWAS %&gt;% \n      dplyr::select(1:2) %&gt;% \n      rename(Female_e0_effect = BETA), \n    \n    Huang_m_18_l_GWAS %&gt;% \n      dplyr::select(1:2) %&gt;% \n      rename(Male_e0_effect = BETA)\n  ) %&gt;% \n  left_join(Huang_f_18_h_GWAS %&gt;% \n              dplyr::select(1:2) %&gt;% \n              rename(Female_h_effect = BETA)) %&gt;% \n  left_join(Huang_m_18_h_GWAS %&gt;% \n              dplyr::select(1:2) %&gt;% \n              rename(Male_h_effect = BETA))\n\n\nHuang_25_two_sexes_SNPS &lt;-\n  left_join(\n    Huang_f_25_l_GWAS %&gt;% \n      dplyr::select(1:2) %&gt;% \n      rename(Female_e0_effect = BETA), \n    \n    Huang_m_25_l_GWAS %&gt;% \n      dplyr::select(1:2) %&gt;% \n      rename(Male_e0_effect = BETA)\n  ) %&gt;% \n  left_join(Huang_f_25_h_GWAS %&gt;% \n              dplyr::select(1:2) %&gt;% \n              rename(Female_h_effect = BETA)) %&gt;% \n  left_join(Huang_m_25_h_GWAS %&gt;% \n              dplyr::select(1:2) %&gt;% \n              rename(Male_h_effect = BETA))  \n\n\nHuang_28_two_sexes_SNPS &lt;-\n  left_join(\n    Huang_f_28_l_GWAS %&gt;% \n      dplyr::select(1:2) %&gt;% \n      rename(Female_e0_effect = BETA), \n    \n    Huang_m_28_l_GWAS %&gt;% \n      dplyr::select(1:2) %&gt;% \n      rename(Male_e0_effect = BETA)\n  ) %&gt;% \n  left_join(Huang_f_28_h_GWAS %&gt;% \n              dplyr::select(1:2) %&gt;% \n              rename(Female_h_effect = BETA)) %&gt;% \n  left_join(Huang_m_28_h_GWAS %&gt;% \n              dplyr::select(1:2) %&gt;% \n              rename(Male_h_effect = BETA))\n\n\nPlot the within-treatment intersex-genetic correlations\n\n\nShow the code\npal &lt;- pnw_palette(\"Shuksan2\", 100)\n\nArya_e0_sex_plot &lt;-\n  Arya_two_sexes_SNPS %&gt;% \n  ggplot(aes(x = Female_e0_effect, y = Male_e0_effect )) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  #geom_point() +\n  #stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 0.75, colour = \"black\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  labs(x = \"Effect on female life expectancy\", \n       y = \"Effect on male\\nlife expectancy\",\n       title = \"Arya et al 2010: 25C\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 10),\n        plot.title = element_text(hjust = 0.5, size = 11))\n\nArya_h_sex_plot &lt;-\n  Arya_two_sexes_SNPS %&gt;% \n  ggplot(aes(x = Female_h_effect, y = Male_h_effect )) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  #geom_point() +\n  #stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 0.75, colour = \"black\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  labs(x = \"Effect on female lifespan equality\", \n       y = \"Effect on male\\nlifespan equality\",\n       title = \"Arya et al 2010: 25C\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 10),\n        plot.title = element_text(hjust = 0.5, size = 11))\n\nHuang_18_e0_sex_plot &lt;-\n  Huang_18_two_sexes_SNPS %&gt;% \n  ggplot(aes(x = Female_e0_effect, y = Male_e0_effect )) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  #geom_point() +\n  #stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 0.75, colour = \"black\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  labs(x = \"Effect on female life expectancy\", \n       y = \"Effect on male\\nlife expectancy\",\n       title = \"Huang et al, 2020: 18C\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 10),\n        plot.title = element_text(hjust = 0.5, size = 11))\n\nHuang_18_h_sex_plot &lt;-\n  Huang_18_two_sexes_SNPS %&gt;% \n  ggplot(aes(x = Female_h_effect, y = Male_h_effect )) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  #geom_point() +\n  #stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 0.75, colour = \"black\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  labs(x = \"Effect on female lifespan equality\", \n       y = \"Effect on male\\nlifespan equality\",\n       title = \"Huang et al, 2020: 18C\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 10),\n        plot.title = element_text(hjust = 0.5, size = 11))\n\nHuang_25_e0_sex_plot &lt;-\n  Huang_25_two_sexes_SNPS %&gt;% \n  ggplot(aes(x = Female_e0_effect, y = Male_e0_effect )) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  #geom_point() +\n  #stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 0.75, colour = \"black\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  labs(x = \"Effect on female life expectancy\", \n       y = \"Effect on male\\nlife expectancy\",\n       title = \"Huang et al, 2020: 25C\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 10),\n        plot.title = element_text(hjust = 0.5, size = 11))\n\nHuang_25_h_sex_plot &lt;-\n  Huang_25_two_sexes_SNPS %&gt;% \n  ggplot(aes(x = Female_h_effect, y = Male_h_effect )) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  #geom_point() +\n  #stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 0.75, colour = \"black\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  labs(x = \"Effect on female lifespan equality\", \n       y = \"Effect on male\\nlifespan equality\",\n       title = \"Huang et al, 2020: 25C\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 10),\n        plot.title = element_text(hjust = 0.5, size = 11))\n\nHuang_28_e0_sex_plot &lt;-\n  Huang_28_two_sexes_SNPS %&gt;% \n  ggplot(aes(x = Female_e0_effect, y = Male_e0_effect )) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  #geom_point() +\n  #stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 0.75, colour = \"black\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  labs(x = \"Effect on female life expectancy\", \n       y = \"Effect on male\\nlife expectancy\",\n       title = \"Huang et al, 2020: 28C\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 10),\n        plot.title = element_text(hjust = 0.5, size = 11))\n\nHuang_28_h_sex_plot &lt;-\n  Huang_28_two_sexes_SNPS %&gt;% \n  ggplot(aes(x = Female_h_effect, y = Male_h_effect )) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  #geom_point() +\n  #stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 0.75, colour = \"black\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  labs(x = \"Effect on female lifespan equality\", \n       y = \"Effect on male\\nlifespan equality\",\n       title = \"Huang et al, 2020: 28C\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 10),\n        plot.title = element_text(hjust = 0.5, size = 11))\n\n(Arya_e0_sex_plot + Arya_h_sex_plot) /\n  (Huang_18_e0_sex_plot + Huang_18_h_sex_plot) / \n  (Huang_25_e0_sex_plot + Huang_25_h_sex_plot) / \n  (Huang_28_e0_sex_plot + Huang_28_h_sex_plot)"
  },
  {
    "objectID": "GWAS.html#the-axis-of-sexual-antagonism",
    "href": "GWAS.html#the-axis-of-sexual-antagonism",
    "title": "Genome wide analyses",
    "section": "The axis of sexual antagonism",
    "text": "The axis of sexual antagonism\nWhile there is a strong inter-sex genetic correlation for both life expectancy and lifespan equality, both correlations are significantly lower than one. Thus, it is likely that there are alleles that have sex-limited or sex-opposite effects on lifespan/lifespan equality. In an attempt to identify the latter, we return to the individual study data, select those studies that measured lifespan in both sexes and calculate a sexual antagonism index for each line, following previous studies focused on similar questions (e.g. Berger et al, 2014, Grieshop and Arnqvist, 2018, Ruzicka et al, 2020). To create the index, we rotate the coordinate system of the female and male fitness plane by 45 degrees, by multiplying the 204 x 2 fitness matrix by the rotation matrix\n\\[\\mathbf{R} = \\begin{bmatrix}\n       \\frac{-1}{\\sqrt{2}} & \\frac{-1}{\\sqrt{2}} \\\\[0.3em]\n       \\frac{-1}{\\sqrt{2}} & \\frac{1}{\\sqrt{2}}  \\\\[0.3em]\n     \\end{bmatrix}\\]\n\n\nShow the code\nrotation_matrix &lt;- \n  matrix(c(-1/sqrt(2), -1/sqrt(2), -1/sqrt(2), 1/sqrt(2)),\n         nrow = 2)\n\nrotate_axis_function &lt;- function(data_1, data_2, Females, Males, metric){\n  left_join(\n    data_1 %&gt;% rename(Females = metric),\n    data_2 %&gt;% rename(Males = metric)) %&gt;% \n    dplyr::select(-line) %&gt;% \n    as.matrix() %*% rotation_matrix %&gt;% \n    as_tibble() %&gt;% \n    rename(SC_axis  = V1,\n           SA_axis = V2) %&gt;% \n    bind_cols(left_join(\n      data_1 %&gt;% rename(Females = metric),\n      data_2%&gt;% rename(Males = metric))) %&gt;% \n    dplyr::select(line, Females, Males, everything())\n}\n  \nArya_l_SA &lt;-\n  rotate_axis_function(Arya_f_l, Arya_m_l, \n                     Females = \"Female_life_expectancy\", \n                     Males = \"Male_life_expectancy\",\n                     metric = \"e0\") \n\nHuang_18_l_SA &lt;-\n  rotate_axis_function(Huang_f_18_l, Huang_m_18_l, \n                     Females = \"Female_life_expectancy\", \n                     Males = \"Male_life_expectancy\",\n                     metric = \"e0\") \n\nHuang_25_l_SA &lt;-\n  rotate_axis_function(Huang_f_25_l, Huang_m_25_l, \n                     Females = \"Female_life_expectancy\", \n                     Males = \"Male_life_expectancy\",\n                     metric = \"e0\") \n\nHuang_28_l_SA &lt;-\n  rotate_axis_function(Huang_f_28_l, Huang_m_28_l, \n                     Females = \"Female_life_expectancy\", \n                     Males = \"Male_life_expectancy\",\n                     metric = \"e0\") \n\n# now lifespan equality\n\nArya_h_SA &lt;-\n  rotate_axis_function(Arya_f_h, Arya_m_h, \n                     Females = \"Female_lifespan_equality\", \n                     Males = \"Male_lifespan_equality\",\n                     metric = \"h\") \n\nHuang_18_h_SA &lt;-\n  rotate_axis_function(Huang_f_18_h, Huang_m_18_h, \n                     Females = \"Female_lifespan_equality\", \n                     Males = \"Male_lifespan_equality\",\n                     metric = \"h\") \n\nHuang_25_h_SA &lt;-\n  rotate_axis_function(Huang_f_25_h, Huang_m_25_h, \n                     Females = \"Female_lifespan_equality\", \n                     Males = \"Male_lifespan_equality\",\n                     metric = \"h\") \n\nHuang_28_h_SA &lt;-\n  rotate_axis_function(Huang_f_28_h, Huang_m_28_h, \n                     Females = \"Female_lifespan_equality\", \n                     Males = \"Male_lifespan_equality\",\n                     metric = \"h\") \n\n\nTo visualise this transformation lets plot the standardised life expectancy means presented in Arya et al 2010\n\n\nShow the code\nArya_l_SA %&gt;% \n  ggplot(aes(x = Females, y = Males)) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  geom_abline(intercept = 0, slope = -1, linewidth = 1, linetype = 2, colour = \"salmon\") +\n  geom_abline(intercept = 0, slope = 1, linewidth = 1, linetype = 2, colour = \"salmon\") +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  geom_point(aes(fill = SA_axis), shape = 21, size = 4) +\n  scale_fill_moma_c(\"Avedon\", direction = -1, limits = c(-2.5, 2.5)) +\n  coord_cartesian(xlim = c(-4, 4), ylim = c(-4, 4)) +\n  labs(fill = \"SA index\",\n       x = \"Life expectancy (female)\",\n       y = \"Life expectancy (male)\",\n       title = \"Arya et al 2010 data\") +\n  theme_bw() +\n  theme(plot.title = element_text(hjust = 0.5))\n\n\n\n\n\nFig XX. Residual line means for female and male life expectancy. Points indicate a single genetic line. The sexual antagonism index ranges from male-beneficial and female-detrimental (orange points) to female-beneficial and male-detrimental (green points). The red dotted lines show the rotation that has been performed to create the antagonism and concordance axis.\nI don’t actually agree that this axis truly represents antagonism. It finds perpendicular departures from the perfect regression, which I guess probably are in part caused by SNPs with sex-opposite effects, but they don’t have to be!"
  },
  {
    "objectID": "GWAS.html#run-univariate-gwas",
    "href": "GWAS.html#run-univariate-gwas",
    "title": "Genome wide analyses",
    "section": "Run univariate GWAS",
    "text": "Run univariate GWAS\n\n\nShow the code\nSA_e0_Arya &lt;- prep_for_SA_GWAS(Arya_l_SA)\nSA_e0_Huang_18 &lt;- prep_for_SA_GWAS(Huang_18_l_SA)\nSA_e0_Huang_25 &lt;- prep_for_SA_GWAS(Huang_25_l_SA)\nSA_e0_Huang_28 &lt;- prep_for_SA_GWAS(Huang_28_l_SA)\n\nSA_h_Arya &lt;- prep_for_SA_GWAS(Arya_h_SA)\nSA_h_Huang_18 &lt;- prep_for_SA_GWAS(Huang_18_h_SA)\nSA_h_Huang_25 &lt;- prep_for_SA_GWAS(Huang_25_h_SA)\nSA_h_Huang_28 &lt;- prep_for_SA_GWAS(Huang_28_h_SA)\n\n\n\nif(!file.exists(\"data/Derived/GWAS_results/SA_e0_Arya.tsv.gz\")) {\nrun_GWAS(SA_e0_Arya)\nrun_GWAS(SA_e0_Huang_18)\nrun_GWAS(SA_e0_Huang_25)\nrun_GWAS(SA_e0_Huang_28)\nrun_GWAS(SA_h_Arya)\nrun_GWAS(SA_h_Huang_18)\nrun_GWAS(SA_h_Huang_25)\nrun_GWAS(SA_h_Huang_28)\n}\n\nSA_e0_Arya_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/SA_e0_Arya.tsv.gz\") \nSA_e0_Huang_18_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/SA_e0_Huang_18.tsv.gz\") \nSA_e0_Huang_25_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/SA_e0_Huang_25.tsv.gz\") \nSA_e0_Huang_28_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/SA_e0_Huang_28.tsv.gz\") \n\nSA_h_Arya_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/SA_h_Arya.tsv.gz\") \nSA_h_Huang_18_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/SA_h_Huang_18.tsv.gz\")\nSA_h_Huang_25_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/SA_h_Huang_25.tsv.gz\")\nSA_h_Huang_28_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/SA_h_Huang_28.tsv.gz\")\n\n\nHow many variants do we find that have notable associations with the SA axis for life expectancy:\n\n\nShow the code\n# filter down tp sig associations\n\nSA_e0_table &lt;-\nbind_rows(\nSA_e0_Arya_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(SA_e0_Arya_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Arya et al 2010\",\n         Temperature = \"25\",\n         `Mating status` = \"Virgin\") %&gt;% \n  dplyr::select(Study, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n  \nSA_e0_Huang_18_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(SA_e0_Huang_18_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Temperature = \"18\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nSA_e0_Huang_25_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(SA_e0_Huang_25_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Temperature = \"25\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nSA_e0_Huang_28_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(SA_e0_Huang_28_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Temperature = \"28\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`)) \n\n# how many unique variants have been detected?\n\nSA_p_05_SNPs_e0 &lt;-\n  bind_rows(\n    \n    SA_e0_Arya_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    SA_e0_Huang_18_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n  \n    SA_e0_Huang_25_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    SA_e0_Huang_28_GWAS %&gt;% \n      filter(P &lt; 0.00005)) %&gt;% \n  distinct(SNP) %&gt;% \n  nrow()\n\n\nSA_e0_table %&gt;% \n  add_row(Study = \"Totals\",\n          Temperature = \"\",\n          `Mating status` = \"\",\n          `p &lt; 0.05e-05 variants` = SA_p_05_SNPs_e0,\n          `p &lt; 0.05e-08 variants` = sum(SA_e0_table$`p &lt; 0.05e-08 variants`)) %&gt;% \n  kable() %&gt;% \n  kable_styling()\n\n\n\n\n\nStudy\nTemperature\nMating status\np &lt; 0.05e-05 variants\np &lt; 0.05e-08 variants\n\n\n\n\nArya et al 2010\n25\nVirgin\n4\n0\n\n\nHuang et al 2020\n18\nMated\n9\n0\n\n\nHuang et al 2020\n25\nMated\n36\n0\n\n\nHuang et al 2020\n28\nMated\n11\n0\n\n\nTotals\n\n\n60\n0\n\n\n\n\n\n\n\nHow many variants do we find that have notable associations with the SA axis for lifespan equality:\n\n\nShow the code\n# filter down tp sig associations\n\nSA_h_table &lt;-\nbind_rows(\nSA_h_Arya_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(SA_h_Arya_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Arya et al 2010\",\n         Temperature = \"25\",\n         `Mating status` = \"Virgin\") %&gt;% \n  dplyr::select(Study, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n  \nSA_h_Huang_18_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(SA_h_Huang_18_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Temperature = \"18\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nSA_h_Huang_25_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(SA_h_Huang_25_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Temperature = \"25\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`),\n\nSA_h_Huang_28_GWAS %&gt;% \n  filter(P &lt; 0.00005) %&gt;% \n  transmute(`p &lt; 0.05e-05 variants` = n(),\n         `p &lt; 0.05e-08 variants` = nrow(filter(SA_h_Huang_28_GWAS, P &lt; 0.00000005))) %&gt;%\n  distinct() %&gt;% \n  mutate(Study = \"Huang et al 2020\",\n         Temperature = \"28\",\n         `Mating status` = \"Mated\") %&gt;% \n  dplyr::select(Study, Temperature, `Mating status`, `p &lt; 0.05e-05 variants`, `p &lt; 0.05e-08 variants`)) \n\n# how many unique variants have been detected?\n\nSA_p_05_SNPs_h &lt;-\n  bind_rows(\n    \n    SA_h_Arya_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    SA_h_Huang_18_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n  \n    SA_h_Huang_25_GWAS %&gt;% \n      filter(P &lt; 0.00005),\n    \n    SA_h_Huang_28_GWAS %&gt;% \n      filter(P &lt; 0.00005)) %&gt;% \n  distinct(SNP) %&gt;% \n  nrow()\n\n\nSA_h_table %&gt;% \n  add_row(Study = \"Totals\",\n          Temperature = \"\",\n          `Mating status` = \"\",\n          `p &lt; 0.05e-05 variants` = SA_p_05_SNPs_h,\n          `p &lt; 0.05e-08 variants` = sum(SA_h_table$`p &lt; 0.05e-08 variants`)) %&gt;% \n  kable() %&gt;% \n  kable_styling()\n\n\n\n\n\nStudy\nTemperature\nMating status\np &lt; 0.05e-05 variants\np &lt; 0.05e-08 variants\n\n\n\n\nArya et al 2010\n25\nVirgin\n1\n0\n\n\nHuang et al 2020\n18\nMated\n8\n0\n\n\nHuang et al 2020\n25\nMated\n18\n0\n\n\nHuang et al 2020\n28\nMated\n9\n0\n\n\nTotals\n\n\n36\n0"
  },
  {
    "objectID": "GWAS.html#run-cpassoc",
    "href": "GWAS.html#run-cpassoc",
    "title": "Genome wide analyses",
    "section": "Run CPASSOC",
    "text": "Run CPASSOC\n\nGenerate the genetic correlation matrix\nWe calculate the genetic correlations between traits using both the line mean and SNP effect size comparisons. We use the SNP correlations following Zhu et al (2015) and show these in the below plots. Note that while the two approaches produce results that have a strong positive correlation, there are small differences that will affect downstream analyses.\n\n\nShow the code\n# use the BETA coefficients to build the SNP correlation matrix\n\nSNP_SA_data_e0 &lt;-\n  bind_rows(\n    SA_e0_Arya_GWAS %&gt;% \n      mutate(Study = \"Arya\", Temperature = 25),\n    SA_e0_Huang_18_GWAS %&gt;% \n      mutate(Study= \"Huang\", Temperature= 18),\n    SA_e0_Huang_25_GWAS %&gt;% \n      mutate(Study= \"Huang\", Temperature= 25),\n    SA_e0_Huang_28_GWAS %&gt;% \n      mutate(Study= \"Huang\", Temperature= 28)) %&gt;% \n  dplyr::select(SNP, BETA, Study, Temperature) %&gt;% \n  pivot_wider(values_from = BETA, names_from = c(Study, Temperature)) %&gt;% \n  dplyr::select(-SNP) \n\nSNP_SA_data_h &lt;-\n  bind_rows(\n    SA_h_Arya_GWAS %&gt;% \n      mutate(Study = \"Arya\", Temperature = 25),\n    SA_h_Huang_18_GWAS %&gt;% \n      mutate(Study= \"Huang\", Temperature= 18),\n    SA_h_Huang_25_GWAS %&gt;% \n      mutate(Study= \"Huang\", Temperature= 25),\n    SA_h_Huang_28_GWAS %&gt;% \n      mutate(Study= \"Huang\", Temperature= 28)) %&gt;% \n  dplyr::select(SNP, BETA, Study, Temperature) %&gt;% \n  pivot_wider(values_from = BETA, names_from = c(Study, Temperature)) %&gt;% \n  dplyr::select(-SNP) \n  \n\nSNP_SA_e0_corr_matrix &lt;- cor(SNP_SA_data_e0, use = \"pairwise.complete.obs\", method = \"spearman\")\nSNP_SA_h_corr_matrix &lt;- cor(SNP_SA_data_h, use = \"pairwise.complete.obs\", method = \"spearman\")\n\nSA_e0_line_data &lt;-\n  bind_rows(Arya_l_SA %&gt;% mutate(Study = \"Arya_25\"),\n            Huang_18_l_SA %&gt;% mutate(Study = \"Huang_18\"),\n            Huang_25_l_SA %&gt;% mutate(Study = \"Huang_25\"),\n            Huang_28_l_SA %&gt;% mutate(Study = \"Huang_28\")) %&gt;% \n  dplyr::select(line, Study, SA_axis) %&gt;% \n  pivot_wider(values_from = SA_axis, names_from = Study) %&gt;% \n  dplyr::select(-line)\n\nSA_h_line_data &lt;-\n  bind_rows(Arya_h_SA %&gt;% mutate(Study = \"Arya_25\"),\n            Huang_18_h_SA %&gt;% mutate(Study = \"Huang_18\"),\n            Huang_25_h_SA %&gt;% mutate(Study = \"Huang_25\"),\n            Huang_28_h_SA %&gt;% mutate(Study = \"Huang_28\")) %&gt;% \n  dplyr::select(line, Study, SA_axis) %&gt;% \n  pivot_wider(values_from = SA_axis, names_from = Study) %&gt;% \n  dplyr::select(-line)\n\nSA_line_e0_corr_matrix &lt;- cor(SA_e0_line_data, use = \"pairwise.complete.obs\", method = \"spearman\")\nSA_line_h_corr_matrix &lt;- cor(SA_h_line_data, use = \"pairwise.complete.obs\", method = \"spearman\")\n\n\n\n\nCalculate meta-analytic test statistics\n\nSA for e0\nThe purpose of this meta-analysis is to search for SNPs that have sex-specific effects on ageing.\nTo conduct CPASSOC for a given SNP, we need a summary statistic from each GWAS. A different number of lines were included in each GWAS, which can cause small differences in the number of SNPs assessed. We therefore prune the list of SNPs to those included in all univariate analyses. After pruning (and previous pruning to remove SNPs in linkage disequilibrium), 220,582 SNPs remain.\n\n\nShow the code\nSA_Arya_l_T &lt;- SA_e0_Arya_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Arya = T)\n  \nSA_Huang_18_l_T &lt;- SA_e0_Huang_18_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_18 = T)\n\nSA_Huang_25_l_T &lt;- SA_e0_Huang_25_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_25 = T)\n\nSA_Huang_28_l_T &lt;- SA_e0_Huang_28_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_28 = T)\n\nSA_e0_effect_sizes &lt;-\n  SA_Arya_l_T %&gt;%\n  inner_join(SA_Huang_18_l_T, by = \"SNP\") %&gt;%\n  inner_join(SA_Huang_25_l_T, by = \"SNP\") %&gt;%\n  inner_join(SA_Huang_28_l_T, by = \"SNP\") \n\n\nSA_e0_effect_size_values &lt;-\n  SA_e0_effect_sizes %&gt;% \n  dplyr::select(2:5)\n\nSample_size_SA &lt;- c(165, 183, 186, 177) \n\nif(!file.exists(\"data/Derived/GWAS_results/SA_e0_meta_results.csv\")) {\n\n# run the homogeneous effect meta-analysis\n\nS_hom &lt;- SHom(SA_e0_effect_size_values, Sample_size_SA, SNP_SA_e0_corr_matrix)\n\n# calculate meta-p-values and bind the two together with the SNP names\n\np_S_hom &lt;- pchisq(S_hom, df = 1, ncp = 0, lower.tail = F) %&gt;% \n  as_tibble() %&gt;% \n  bind_cols(S_hom) %&gt;% \n  rename(meta_p_hom = value, \n         S_hom = ...2)\n\n# Calculate S_het, an extension of S_hom that improves power when the genetic effect sizes vary for different traits (e.g. if a SNP has a sex or enviornment opposite effect on lifespan)\n\n# estimate parameters of gamma distribution\n\npara &lt;- EstimateGamma(N = 1E4, Sample_size_SA, SNP_SA_e0_corr_matrix);\n\nS_het &lt;- SHet(SA_e0_effect_size_values, Sample_size_SA, SNP_SA_e0_corr_matrix)\n\n# obtain P-values of S_Het using the estimated gamma parameters\n  \np_S_het &lt;- pgamma(q = S_het-para[3], shape = para[1], scale = para[2], lower.tail = F) %&gt;% \n  as_tibble() %&gt;% \n  bind_cols(S_het) %&gt;% \n  rename(meta_p_het = value, \n         S_het = ...2)\n\n\nSA_e0_meta_results &lt;- \n  SA_e0_effect_sizes %&gt;% \n  bind_cols(p_S_hom,\n            p_S_het) # add the unadjusted p values\n\nwrite_csv(SA_e0_meta_results, \"data/Derived/GWAS_results/SA_e0_meta_results.csv\")\n\n} else SA_e0_meta_results &lt;- read_csv(\"data/Derived/GWAS_results/SA_e0_meta_results.csv\")\n\n\n\n\nSA for lifespan equality\n\n\nShow the code\n# lifespan equality\n\nSA_Arya_h_T &lt;- SA_h_Arya_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Arya = T)\n  \nSA_Huang_18_h_T &lt;- SA_h_Huang_18_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_18 = T)\n\nSA_Huang_25_h_T &lt;- SA_h_Huang_25_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_25 = T)\n\nSA_Huang_28_h_T &lt;- SA_h_Huang_28_GWAS %&gt;% \n  dplyr::select(SNP, T) %&gt;% \n  rename(Huang_28 = T)\n\nSA_h_effect_sizes &lt;-\n  SA_Arya_h_T %&gt;%\n  inner_join(SA_Huang_18_h_T, by = \"SNP\") %&gt;%\n  inner_join(SA_Huang_25_h_T, by = \"SNP\") %&gt;%\n  inner_join(SA_Huang_28_h_T, by = \"SNP\") \n\n\nSA_h_effect_size_values &lt;-\n  SA_h_effect_sizes %&gt;% \n  dplyr::select(2:5)\n\nif(!file.exists(\"data/Derived/GWAS_results/SA_h_meta_results.csv\")) {\n\nS_hom &lt;- SHom(SA_h_effect_size_values, Sample_size_SA, SNP_SA_h_corr_matrix)\n\n# calculate meta-p-values and bind the two together with the SNP names\n\np_S_hom &lt;- pchisq(S_hom, df = 1, ncp = 0, lower.tail = F) %&gt;% \n  as_tibble() %&gt;% \n  bind_cols(S_hom) %&gt;% \n  rename(meta_p_hom = value, \n         S_hom = ...2)\n\n# Calculate S_het, an extension of S_hom that improves power when the genetic effect sizes vary for different traits (probably not such a problem here given all traits we investigate are some version of life expectancy)\n\n# estimate parameters of gamma distribution\n\npara &lt;- EstimateGamma(N = 1E4, Sample_size_SA, SNP_SA_h_corr_matrix);\n\nS_het &lt;- SHet(SA_h_effect_size_values, Sample_size_SA, SNP_SA_h_corr_matrix)\n\n# obtain P-values of S_Het using the estimated gamma parameters\n  \np_S_het &lt;- pgamma(q = S_het-para[3], shape = para[1], scale = para[2], lower.tail = F) %&gt;% \n  as_tibble() %&gt;% \n  bind_cols(S_het) %&gt;% \n  rename(meta_p_het = value, \n         S_het = ...2)\n\n\nSA_h_meta_results &lt;- \n  SA_h_effect_sizes %&gt;% \n  bind_cols(p_S_hom,\n            p_S_het) # add the unadjusted p values\n\nwrite_csv(SA_h_meta_results, \"data/Derived/GWAS_results/SA_h_meta_results.csv\")\n} else SA_h_meta_results &lt;- read_csv(\"data/Derived/GWAS_results/SA_h_meta_results.csv\")"
  },
  {
    "objectID": "GWAS.html#plot-the-results-1",
    "href": "GWAS.html#plot-the-results-1",
    "title": "Genome wide analyses",
    "section": "Plot the results",
    "text": "Plot the results\nWe combine GWAS summary statistics calculated from lifespan data measured across different contexts. It’s possible that some SNPs have G x E interactions that would lead to a heterogeneous effect across phenotypes. We therefore utilise the S_het calculated p-values.\nFirst lets show the effect of CPASSOC on the number of variants found to be associated with life expectancy and lifespan equality.\nTable XX. Genotype to phenotype associations detected by univariate GWAS, for lifespan equality. The total row shows the number of unique candidate variants identified across all studies.\n\n\nShow the code\ntibble(Analysis = c(\"CPASSOC\", \"Univariate\", \"CPASSOC\", \"Univariate\"),\n       Trait = c(\"Life expectancy\", \"Life expectancy\", \"Lifespan equality\", \"Lifespan equality\"),\n       `p &lt; 0.05e-05 variants` = c(sum(SA_e0_meta_results$meta_p_het &lt; 0.00005),\n                                  SA_p_05_SNPs_e0,\n                                  sum(SA_h_meta_results$meta_p_het &lt; 0.00005),\n                                  SA_p_05_SNPs_h),\n       `p &lt; 0.05e-08 variants` = c(sum(SA_e0_meta_results$meta_p_het &lt; 0.00000005),\n                                  sum(SA_e0_table$`p &lt; 0.05e-08 variants`),\n                                  sum(SA_h_meta_results$meta_p_het &lt; 0.00000005),\n                                  sum(SA_h_table$`p &lt; 0.05e-08 variants`)))  %&gt;% \n  kable() %&gt;% \n  kable_styling()\n\n\n\n\n\nAnalysis\nTrait\np &lt; 0.05e-05 variants\np &lt; 0.05e-08 variants\n\n\n\n\nCPASSOC\nLife expectancy\n32\n0\n\n\nUnivariate\nLife expectancy\n60\n0\n\n\nCPASSOC\nLifespan equality\n17\n0\n\n\nUnivariate\nLifespan equality\n36\n0\n\n\n\n\n\n\n\nShow the code\n#SA_e0_meta_results %&gt;% filter(meta_p_hom &lt; 0.00005) %&gt;% \n # anti_join(SA_p_05_SNPs_e0) %&gt;% arrange(meta_p_hom)\n#SA_p_05_SNPs_e0\n\n\nNow lets build some ‘Manhattan plots’ to show where these significant associations can be found:\n\n\nShow the code\nSA_common_SNPs &lt;- \n  SA_e0_meta_results %&gt;% filter(meta_p_het &lt; 0.00005) %&gt;%\n  inner_join(SA_h_meta_results %&gt;% filter(meta_p_het &lt; 0.00005), by = \"SNP\") %&gt;% \n  mutate(common_SNP = \"YES\") %&gt;% \n  dplyr::select(SNP, common_SNP)\n\nSA_e0_results &lt;- \n  SA_e0_meta_results %&gt;% \n  dplyr::select(SNP, meta_p_hom, meta_p_het) %&gt;% \n  rename(P = meta_p_het) %&gt;% \n  left_join(common_SNPs) %&gt;% \n  mutate(common_SNP = if_else(is.na(common_SNP), \"NO\", common_SNP))\n  \n\nSA_h_results &lt;- \n  SA_h_meta_results %&gt;% \n  dplyr::select(SNP, meta_p_hom, meta_p_het) %&gt;% \n  rename(P = meta_p_het) %&gt;% \n  left_join(common_SNPs) %&gt;% \n  mutate(common_SNP = if_else(is.na(common_SNP), \"NO\", common_SNP))\n\n# plot the results using the manhattan plot custom function we defined earlier\n\nSA_e0_het_plot &lt;- \n  build_manhattan_plot(SA_e0_results) +\n  labs(title = \"SA axis for life expectancy\") +\n  theme(plot.title = element_text(size = 20, hjust = 0.5)) +\n  coord_cartesian(ylim = c(0, 10))\n\nSA_h_het_plot &lt;-\n  build_manhattan_plot(SA_h_results) +\n  labs(title = \"SA axis for lifespan equality\") +\n  theme(plot.title = element_text(size = 20, hjust = 0.5)) +\n  coord_cartesian(ylim = c(0, 10))\n\n\nSA_e0_het_plot + SA_h_het_plot"
  },
  {
    "objectID": "GWAS.html#generating-predictions-through-simulation",
    "href": "GWAS.html#generating-predictions-through-simulation",
    "title": "Genome wide analyses",
    "section": "Generating predictions through simulation",
    "text": "Generating predictions through simulation\nThe simulations produce phenotypes for 200 lines numbered 1-200. This closely matches the number in the DGRP that have been genotyped. We randomly assign each line one of the true DGRP line numbers to run the GWAS. We run the simulations twice, with different line assignments to check whether line identity changes the shape of the correlations.\n\n\nShow the code\n{set.seed(1)\nlines &lt;- residual_f_l %&gt;% dplyr::select(line) %&gt;% \n  slice_sample(n = 200)}\n\n{set.seed(2)\nlines_2 &lt;- residual_f_l %&gt;% dplyr::select(line) %&gt;% \n  slice_sample(n = 200)\n}\n\nno_change_sim &lt;- read_csv(\"GWAS simulation data/data_lifespan_no_change.csv\")\na_change_sim &lt;- read_csv(\"GWAS simulation data/data_lifespan_a_change.csv\")\nb_change_sim &lt;- read_csv(\"GWAS simulation data/data_lifespan_b_change.csv\")\nab_change_sim &lt;- read_csv(\"GWAS simulation data/data_lifespan_ab_change.csv\")\n\n\n\nRun 1Run 2\n\n\n\n\nShow the code\n# Run the GWAS if we haven't already\n\nif(!file.exists(\"data/Derived/GWAS_results/e0_no_change_sim_data.tsv.gz\")){ \n\ne0_no_change_sim_data &lt;- prep_for_e0_GWAS(no_change_sim) %&gt;%\n  mutate(line = lines$line) \n\nrun_GWAS(e0_no_change_sim_data)\n\ne0_a_change_sim_data &lt;-prep_for_e0_GWAS(a_change_sim) %&gt;%\n  mutate(line = lines$line)\n\nrun_GWAS(e0_a_change_sim_data)\n\ne0_b_change_sim_data &lt;- \n  prep_for_e0_GWAS(b_change_sim) %&gt;%\n  mutate(line = lines$line)\n\nrun_GWAS(e0_b_change_sim_data)\n\ne0_ab_change_sim_data &lt;-\nprep_for_e0_GWAS(ab_change_sim) %&gt;%\n  mutate(line = lines$line)\n\nrun_GWAS(e0_ab_change_sim_data)\n\n# Lifespan equality\n\nh_no_change_sim_data &lt;-\nprep_for_h_GWAS(no_change_sim) %&gt;%\n  mutate(line = lines$line)\n\nrun_GWAS(h_no_change_sim_data)\n\nh_a_change_sim_data &lt;-\nprep_for_h_GWAS(a_change_sim) %&gt;%\n  mutate(line = lines$line)\n\nrun_GWAS(h_a_change_sim_data)\n\nh_b_change_sim_data &lt;-\nprep_for_h_GWAS(b_change_sim) %&gt;%\n  mutate(line = lines$line)\n\nrun_GWAS(h_b_change_sim_data)\n\nh_ab_change_sim_data &lt;-\nprep_for_h_GWAS(ab_change_sim) %&gt;%\n  mutate(line = lines$line)\n\nrun_GWAS(h_ab_change_sim_data)\n}\n\n\nLoad the GWAS results generated from the gompertz simulations\n\n\nShow the code\ne0_no_change_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/e0_no_change_sim_data.tsv.gz\")\nh_no_change_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/h_no_change_sim_data.tsv.gz\")\n\nno_change_SNP_simulation &lt;-\n  e0_no_change_GWAS %&gt;% \n  rename(e0_effect = BETA) %&gt;% \n  #mutate(Sex = \"Female\") %&gt;% \n  dplyr::select(SNP, e0_effect) %&gt;% \n  left_join(\n    h_no_change_GWAS %&gt;% \n      rename(h_effect = BETA) %&gt;% \n      #mutate(Sex = \"Male\") %&gt;% \n      dplyr::select(SNP, h_effect))\n\ne0_a_change_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/e0_a_change_sim_data.tsv.gz\")\nh_a_change_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/h_a_change_sim_data.tsv.gz\")\n\na_change_SNP_simulation &lt;-\n  e0_a_change_GWAS %&gt;% \n  rename(e0_effect = BETA) %&gt;% \n  dplyr::select(SNP, e0_effect) %&gt;% \n  left_join(\n    h_a_change_GWAS %&gt;% \n      rename(h_effect = BETA) %&gt;% \n      dplyr::select(SNP, h_effect))\n\ne0_b_change_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/e0_b_change_sim_data.tsv.gz\")\nh_b_change_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/h_b_change_sim_data.tsv.gz\")\n\nb_change_SNP_simulation &lt;-\n  e0_b_change_GWAS %&gt;% \n  rename(e0_effect = BETA) %&gt;% \n  dplyr::select(SNP, e0_effect) %&gt;% \n  left_join(\n    h_b_change_GWAS %&gt;% \n      rename(h_effect = BETA) %&gt;% \n      dplyr::select(SNP, h_effect))\n\ne0_ab_change_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/e0_ab_change_sim_data.tsv.gz\")\nh_ab_change_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/h_ab_change_sim_data.tsv.gz\")\n\nab_change_SNP_simulation &lt;-\n  e0_ab_change_GWAS %&gt;% \n  rename(e0_effect = BETA) %&gt;% \n  dplyr::select(SNP, e0_effect) %&gt;% \n  left_join(\n    h_ab_change_GWAS %&gt;% \n      rename(h_effect = BETA) %&gt;% \n      dplyr::select(SNP, h_effect))\n\n\nNow we can plot the results to gain some insight into the predicted correlations\n\n\nShow the code\nsim_plot_no_change &lt;-\n  no_change_SNP_simulation %&gt;% \n  ggplot(aes(x = e0_effect, y = h_effect)) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 1, colour = \"red\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  xlab(\"Effect on life expectancy\") + \n  ylab(\"Effect on lifespan equality\") +\n  labs(title = \"No change in a or b\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 12))\n\nsim_plot_a_change &lt;-\n  a_change_SNP_simulation %&gt;% \n  ggplot(aes(x = e0_effect, y = h_effect)) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 1, colour = \"red\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  xlab(\"Effect on life expectancy\") + \n  ylab(\"Effect on lifespan equality\") +\n  labs(title = \"Change in a\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 12))\n\nsim_plot_b_change &lt;-\n  b_change_SNP_simulation %&gt;% \n  ggplot(aes(x = e0_effect, y = h_effect)) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 1, colour = \"red\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  xlab(\"Effect on life expectancy\") + \n  ylab(\"Effect on lifespan equality\") +\n  labs(title = \"Change in b\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 12))\n\nsim_plot_ab_change &lt;-\n  ab_change_SNP_simulation %&gt;% \n  ggplot(aes(x = e0_effect, y = h_effect)) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 1, colour = \"red\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  xlab(\"Effect on life expectancy\") + \n  ylab(\"Effect on lifespan equality\") +\n  labs(title = \"Change in a and b\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 12))\n\n(sim_plot_no_change + sim_plot_a_change) / (sim_plot_b_change + sim_plot_ab_change)\n\n\n\n\n\n\n\n\n\nShow the code\n# Run the GWAS again, this time with a different line assigned to each row. The idea is to check whether line identity changes the shape of the correlation\n\nif(!file.exists(\"data/Derived/GWAS_results/e0_no_change_sim_data_2.tsv.gz\")){ \n\ne0_no_change_sim_data_2 &lt;- prep_for_e0_GWAS(no_change_sim) %&gt;%\n  mutate(line = lines_2$line) \n\nrun_GWAS(e0_no_change_sim_data_2)\n\ne0_a_change_sim_data_2 &lt;-prep_for_e0_GWAS(a_change_sim) %&gt;%\n  mutate(line = lines_2$line)\n\nrun_GWAS(e0_a_change_sim_data_2)\n\ne0_b_change_sim_data_2 &lt;- \n  prep_for_e0_GWAS(b_change_sim) %&gt;%\n  mutate(line = lines_2$line)\n\nrun_GWAS(e0_b_change_sim_data_2)\n\ne0_ab_change_sim_data_2 &lt;-\nprep_for_e0_GWAS(ab_change_sim) %&gt;%\n  mutate(line = lines_2$line)\n\nrun_GWAS(e0_ab_change_sim_data_2)\n\n# Lifespan equality\n\nh_no_change_sim_data_2 &lt;-\nprep_for_h_GWAS(no_change_sim) %&gt;%\n  mutate(line = lines_2$line)\n\nrun_GWAS(h_no_change_sim_data_2)\n\nh_a_change_sim_data_2 &lt;-\nprep_for_h_GWAS(a_change_sim) %&gt;%\n  mutate(line = lines_2$line)\n\nrun_GWAS(h_a_change_sim_data_2)\n\nh_b_change_sim_data_2 &lt;-\nprep_for_h_GWAS(b_change_sim) %&gt;%\n  mutate(line = lines_2$line)\n\nrun_GWAS(h_b_change_sim_data_2)\n\nh_ab_change_sim_data_2 &lt;-\nprep_for_h_GWAS(ab_change_sim) %&gt;%\n  mutate(line = lines_2$line)\n\nrun_GWAS(h_ab_change_sim_data_2)\n}\n\n\nLoad the GWAS results generated from the gompertz simulations\n\n\nShow the code\ne0_no_change_GWAS_2 &lt;- read_tsv(\"data/Derived/GWAS_results/e0_no_change_sim_data_2.tsv.gz\")\nh_no_change_GWAS_2 &lt;- read_tsv(\"data/Derived/GWAS_results/h_no_change_sim_data_2.tsv.gz\")\n\nno_change_SNP_simulation_2 &lt;-\n  e0_no_change_GWAS_2 %&gt;% \n  rename(e0_effect = BETA) %&gt;% \n  #mutate(Sex = \"Female\") %&gt;% \n  dplyr::select(SNP, e0_effect) %&gt;% \n  left_join(\n    h_no_change_GWAS_2 %&gt;% \n      rename(h_effect = BETA) %&gt;% \n      #mutate(Sex = \"Male\") %&gt;% \n      dplyr::select(SNP, h_effect))\n\ne0_a_change_GWAS_2 &lt;- read_tsv(\"data/Derived/GWAS_results/e0_a_change_sim_data_2.tsv.gz\")\nh_a_change_GWAS_2 &lt;- read_tsv(\"data/Derived/GWAS_results/h_a_change_sim_data_2.tsv.gz\")\n\na_change_SNP_simulation_2 &lt;-\n  e0_a_change_GWAS_2 %&gt;% \n  rename(e0_effect = BETA) %&gt;% \n  dplyr::select(SNP, e0_effect) %&gt;% \n  left_join(\n    h_a_change_GWAS_2 %&gt;% \n      rename(h_effect = BETA) %&gt;% \n      dplyr::select(SNP, h_effect))\n\ne0_b_change_GWAS_2 &lt;- read_tsv(\"data/Derived/GWAS_results/e0_b_change_sim_data_2.tsv.gz\")\nh_b_change_GWAS_2 &lt;- read_tsv(\"data/Derived/GWAS_results/h_b_change_sim_data_2.tsv.gz\")\n\nb_change_SNP_simulation_2 &lt;-\n  e0_b_change_GWAS_2 %&gt;% \n  rename(e0_effect = BETA) %&gt;% \n  dplyr::select(SNP, e0_effect) %&gt;% \n  left_join(\n    h_b_change_GWAS_2 %&gt;% \n      rename(h_effect = BETA) %&gt;% \n      dplyr::select(SNP, h_effect))\n\ne0_ab_change_GWAS_2 &lt;- read_tsv(\"data/Derived/GWAS_results/e0_ab_change_sim_data_2.tsv.gz\")\nh_ab_change_GWAS_2 &lt;- read_tsv(\"data/Derived/GWAS_results/h_ab_change_sim_data_2.tsv.gz\")\n\nab_change_SNP_simulation_2 &lt;-\n  e0_ab_change_GWAS_2 %&gt;% \n  rename(e0_effect = BETA) %&gt;% \n  dplyr::select(SNP, e0_effect) %&gt;% \n  left_join(\n    h_ab_change_GWAS_2 %&gt;% \n      rename(h_effect = BETA) %&gt;% \n      dplyr::select(SNP, h_effect))\n\n\nPlot the results from the second run\n\n\nShow the code\nsim_plot_no_change_2 &lt;-\n  no_change_SNP_simulation_2 %&gt;% \n  ggplot(aes(x = e0_effect, y = h_effect)) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 1, colour = \"red\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  xlab(\"Effect on life expectancy\") + \n  ylab(\"Effect on lifespan equality\") +\n  labs(title = \"No change in a or b\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 12))\n\nsim_plot_a_change_2 &lt;-\n  a_change_SNP_simulation_2 %&gt;% \n  ggplot(aes(x = e0_effect, y = h_effect)) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 1, colour = \"red\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  xlab(\"Effect on life expectancy\") + \n  ylab(\"Effect on lifespan equality\") +\n  labs(title = \"Change in a\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 12))\n\nsim_plot_b_change_2 &lt;-\n  b_change_SNP_simulation_2 %&gt;% \n  ggplot(aes(x = e0_effect, y = h_effect)) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 1, colour = \"red\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  xlab(\"Effect on life expectancy\") + \n  ylab(\"Effect on lifespan equality\") +\n  labs(title = \"Change in b\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 12))\n\nsim_plot_ab_change_2 &lt;-\n  ab_change_SNP_simulation_2 %&gt;% \n  ggplot(aes(x = e0_effect, y = h_effect)) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 1, colour = \"red\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  xlab(\"Effect on life expectancy\") + \n  ylab(\"Effect on lifespan equality\") +\n  labs(title = \"Change in a and b\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 12))\n\n(sim_plot_no_change_2 + sim_plot_a_change_2) / (sim_plot_b_change_2 + sim_plot_ab_change_2)"
  },
  {
    "objectID": "GWAS.html#the-real-data",
    "href": "GWAS.html#the-real-data",
    "title": "Genome wide analyses",
    "section": "The real data",
    "text": "The real data\nFirst, let’s have a look at the shape and pace relationship within studies and treatments\n\n\nShow the code\nentire_SNP_set &lt;- \n   bind_rows(\n    Arya_f_l_GWAS %&gt;% \n      mutate(Study = \"Arya_2010\", Sex = \"Female\", Temperature = 25),\n    Huang_f_18_l_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Female\", Temperature= 18),\n    Huang_f_25_l_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Female\", Temperature= 25),\n    Huang_f_28_l_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Female\", Temperature= 28),\n    Wilson_f_l_GWAS %&gt;% \n      mutate(Study= \"Wilson_2020\", Sex= \"Female\", Temperature= 25),\n    Durham_f_l_GWAS %&gt;% \n      mutate(Study= \"Durham_2014\", Sex= \"Female\", Temperature= 25),\n    Patel_f_l_GWAS %&gt;% \n      mutate(Study= \"Patel_2021\", Sex= \"Female\", Temperature= 23),\n    Arya_m_l_GWAS %&gt;% \n      mutate(Study= \"Arya_2010\", Sex= \"Male\", Temperature= 25),\n    Huang_m_18_l_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Male\", Temperature= 18),\n    Huang_m_25_l_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Male\", Temperature = 25),\n    Huang_m_28_l_GWAS %&gt;% \n      mutate(Study = \"Huang_2020\", Sex = \"Male\", Temperature = 28)) %&gt;% \n  dplyr::select(SNP, BETA, Study, Sex, Temperature) %&gt;% \n  rename(e0_effect = BETA) %&gt;% \n  left_join(\n     bind_rows(\n    Arya_f_h_GWAS %&gt;% \n      mutate(Study = \"Arya_2010\", Sex = \"Female\", Temperature = 25),\n    Huang_f_18_h_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Female\", Temperature= 18),\n    Huang_f_25_h_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Female\", Temperature= 25),\n    Huang_f_28_h_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Female\", Temperature= 28),\n    Wilson_f_h_GWAS %&gt;% \n      mutate(Study= \"Wilson_2020\", Sex= \"Female\", Temperature= 25),\n    Durham_f_h_GWAS %&gt;% \n      mutate(Study= \"Durham_2014\", Sex= \"Female\", Temperature= 25),\n    Patel_f_h_GWAS %&gt;% \n      mutate(Study= \"Patel_2021\", Sex= \"Female\", Temperature= 23),\n    Arya_m_h_GWAS %&gt;% \n      mutate(Study= \"Arya_2010\", Sex= \"Male\", Temperature= 25),\n    Huang_m_18_h_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Male\", Temperature= 18),\n    Huang_m_25_h_GWAS %&gt;% \n      mutate(Study= \"Huang_2020\", Sex= \"Male\", Temperature = 25),\n    Huang_m_28_h_GWAS %&gt;% \n      mutate(Study = \"Huang_2020\", Sex = \"Male\", Temperature = 28)) %&gt;% \n  dplyr::select(SNP, BETA, Study, Sex, Temperature) %&gt;% \n    rename(h_effect = BETA)\n  ) %&gt;% \n  unite(col = \"Treatment\", Study:Temperature, sep = \" \")\n\nBig_cor_plot &lt;-\n  entire_SNP_set %&gt;% \n    ggplot(aes(x = e0_effect, y = h_effect)) +\n    geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n    geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n    stat_binhex(bins = 50) +\n    scale_fill_gradientn(colours = pal) +\n    #stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 1, colour = \"black\") +\n    coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n    facet_wrap(~Treatment) +\n    xlab(\"Minor allele effect on life expectancy\") + \n    ylab(\"Minor allele effect on lifespan equality\") +\n    theme_bw() +\n    theme(legend.position = \"none\",\n          text = element_text(size = 12),\n          plot.title = element_text(hjust = 0.5))\n\nBig_cor_plot\n\n\n\n\n\nSo within treatments we always find a strong positive genetic correlation between life expectancy and lifespan equality."
  },
  {
    "objectID": "GWAS.html#using-the-residual-genotypic-values",
    "href": "GWAS.html#using-the-residual-genotypic-values",
    "title": "Genome wide analyses",
    "section": "Using the residual genotypic values",
    "text": "Using the residual genotypic values\nUsing a hierarchical model, we previously partitioned the variance in life expectancy and lifespan equality caused by variation in:\n\nTemperature\nMating status\nStudy conditions e.g. lab effects such as diet used.\nMeasurement error\n\nWith these sources of variation quantified, we can account for them and predict line means for both life expectancy and lifespan equality. These means approximate the phenotypic product of the additive genotype that is not affected by the (measured) environment i.e. the phenotypic effects of alleles that influence ageing in response to temperature etc. are not included in these residual means.\n\n\nShow the code\nif(!file.exists(\"data/Derived/GWAS_results/residual_f_l.tsv.gz\")){\n  run_GWAS(residual_f_l)\n  run_GWAS(residual_m_l)\n  run_GWAS(residual_f_h)\n  run_GWAS(residual_m_h)\n}\n\nresidual_f_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/residual_f_l.tsv.gz\") \nresidual_m_l_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/residual_m_l.tsv.gz\") \nresidual_f_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/residual_f_h.tsv.gz\") \nresidual_m_h_GWAS &lt;- read_tsv(\"data/Derived/GWAS_results/residual_m_h.tsv.gz\") \n\nresidual_SNP_data &lt;-\n  residual_f_l_GWAS %&gt;% \n  rename(Lifespan_female = BETA) %&gt;% \n  dplyr::select(SNP, Lifespan_female) %&gt;% \n  left_join(\n    residual_m_l_GWAS %&gt;% \n      rename(Lifespan_male = BETA) %&gt;% \n      dplyr::select(SNP, Lifespan_male)) %&gt;% \n  left_join(\n    residual_f_h_GWAS %&gt;% \n      rename(Equality_female = BETA) %&gt;% \n      dplyr::select(SNP, Equality_female)) %&gt;% \n  left_join(\n    residual_m_h_GWAS %&gt;% \n      rename(Equality_male = BETA) %&gt;% \n      dplyr::select(SNP, Equality_male))\n\n\nCalculate the genetic correlation between life expectancy and lifespan equality, measured in both sexes.\n\n\nShow the code\nresidual_SNP_data %&gt;% \n  dplyr::select(-SNP) %&gt;% \n  cor(use = \"pairwise.complete.obs\") %&gt;% \n  kable(digits = 3) %&gt;% kable_styling()\n\n\n\n\n\n\nLifespan_female\nLifespan_male\nEquality_female\nEquality_male\n\n\n\n\nLifespan_female\n1.000\n0.720\n-0.262\n-0.188\n\n\nLifespan_male\n0.720\n1.000\n-0.313\n-0.243\n\n\nEquality_female\n-0.262\n-0.313\n1.000\n0.676\n\n\nEquality_male\n-0.188\n-0.243\n0.676\n1.000\n\n\n\n\n\n\n\nIntriguingly, life expectancy now has a negative genetic correlation with lifespan equality. So what’s so different about the GWA beta coefficients calculated from the residual line mean values?\nLets plot the data to show these genetic correlations\n\n\nShow the code\ne0_h_plot_female &lt;-\n  residual_SNP_data %&gt;% \n  ggplot(aes(x = Lifespan_female, y = Equality_female)) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 1, colour = \"red\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  xlab(\"Effect on female lifespan\") + \n  ylab(\"Effect on female lifespan equality\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 12))\n\ne0_h_plot_male &lt;-\n  residual_SNP_data %&gt;% \n  ggplot(aes(x = Lifespan_male, y = Equality_male)) +\n  geom_vline(xintercept = 0, linetype = 2, linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = 2, linewidth = 1) +\n  stat_binhex(bins = 50) +\n  scale_fill_gradientn(colours = pal) +\n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), linewidth = 1, colour = \"red\") +\n  coord_cartesian(xlim = c(-0.8, 0.8), ylim = c(-0.8, 0.8)) +\n  xlab(\"Effect on male lifespan\") + \n  ylab(\"Effect on male\\nlifespan equality\") +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        text = element_text(size = 12))\n\ne0_h_plot_female / e0_h_plot_male + plot_annotation(tag_levels = \"A\")"
  },
  {
    "objectID": "home.html",
    "href": "home.html",
    "title": "Project home",
    "section": "",
    "text": "Is ageing really invariant within species? A case study using Drosophila melanogaster.\nThis page is a work in progress. Eventually it will contain a report that documents our analysis, with the aim to make it as reproducible and freely available as possible. For now, we just include the list of studies that we used to produce the results you might have seen on our poster.\n\n\nStudies\nNatural variation, functional pleiotropy and transcriptional contexts of odorant binding proteins in Drosophila melanogaster\nAuthors: Arya, Weber, Wang, Magwire, Mackay and Anholt\nYear: 2010\nJournal: Genetics\nDOI: 10.1534/genetics.110.123166\nAbstract: How functional diversification affects the organization of the transcriptome is a central question in systems genetics. To explore this issue, we sequenced all six Odorant binding protein ( Obp) genes located on the X chromosome, four of which occur as a cluster, in 219 inbred wild-derived lines of Drosophila melanogaster and tested for associations between genetic and phenotypic variation at the organismal and transcriptional level. We observed polymorphisms in Obp8a, Obp19a, Obp19b,and Obp19c associated with variation in olfactory responses and polymorphisms in Obp19d associated with variation in life span. We inferred the transcriptional context, or “niche,” of each gene by identifying expression polymorphisms where genetic variation in these Obp genes was associated with variation in expression of transcripts genetically correlated to each Obp gene. All six Obp genes occupied a distinct transcriptional niche. Gene ontology enrichment analysis revealed associations of different Obp transcriptional niches with olfactory behavior, synaptic transmission, detection of signals regulating tissue development and apoptosis, postmating behavior and oviposition, and nutrient sensing. Our results show that diversification of the Obp family has organized distinct transcriptional niches that reflect their acquisition of additional functions.\nGenetic variation of dietary restriction and the effects of nutrient-free water and amino acid supplements on lifespan and fecundity of Drosophila\nAuthors: Dick, Ross and Yampolsky\nYear: 2011\nJournal: Genetics Research\nDOI: 10.1017/S001667231100019X\nAbstract: We measure genetic variation in lifespan and fecundity at two food levels in 34 core lines of the Drosophila Genetic Reference Panel collection. Lines were significantly different from each other in lifespan and fecundity at both restricted and full food. There was a strong food-by-line interaction for the slope of age-specific mortality, fecundity and proportion of fertilized eggs, indicating the presence of genetic variation for the strength of the dietary restriction effect, likely to represent standing genetic variation in a natural population from which the lines used have originated. No trade-off between fecundity and lifespan manifested in life-history variation among inbred lines. Our data partially corroborate the recent proposition that availability of nutrient-free water eliminates the apparent dietary restriction at least in some conditions. Although flies on full food with water added had lifespan slightly higher than those without a water source, it was still significantly lower than that in flies on restricted food, with no indication of interaction. We fully corroborate the recently discovered effect of addition of essential amino acids to the medium: addition of 1.5 mM methionine to restricted food significantly increased fecundity without a measurable decrease in lifespan; addition of each of 10 essential amino acids increased fecundity and decreased females lifespan to the levels observed on full food, again with no evidence of line-by-food interactions. We propose a mechanistic hypothesis explaining the observed data, based on the assumption that food consumption by flies is adjusted according to flies’ saturation in water and methionine.\nGenome-wide analysis in Drosophila reveals age-specific effects of SNPs on fitness traits\nAuthors: Durham, Magwire, Stone, Leips\nYear: 2014\nJournal: Nature Communications\nDOI: 10.1038/ncomms5338\nAbstract: Most organisms exhibit senescence; a decline in physiological function with age. In nature, rates of senescence vary extensively among individuals and this variation has a significant genetic component; however, we know little about the genes underlying senescence. Here we show the first evidence that individual alleles influence fecundity in an age-specific manner and so the genetic basis of natural variation in fecundity changes dramatically with age. We complete a genome-wide association to identify single-nucleotide polymorphisms (SNPs) affecting lifespan and age-specific fecundity using the Drosophila melanogaster Genetic Reference Panel. We identify 1,031 SNPs affecting fecundity and 52 influencing lifespan. Only one SNP is associated with both early- and late-age fecundity. The age-specific effect of candidate genes on fecundity is validated using RNA interference. In addition, there is a dramatic increase in the number of SNPs influencing fecundity with age. This result provides support for the mutation accumulation theory of aging.\nContext-dependent genetic architecture of Drosophila lifespan\nAuthors: Huang, Campbell, Carbone, Jones, Unselt, Anholt and Mackay\nYear: 2020\nJournal: PLoS Biology\nDOI: https://doi.org/10.1371/journal.pbio.3000645\nAbstract: Understanding the genetic basis of variation in life span is a major challenge that is difficult to address in human populations. Evolutionary theory predicts that alleles affecting natural variation in life span will have properties that enable them to persist in populations at intermediate frequencies, such as late-life–specific deleterious effects, antagonistic pleiotropic effects on early and late-age fitness components, and/or sex- and environment-specific or antagonistic effects. Here, we quantified variation in life span in males and females reared in 3 thermal environments for the sequenced, inbred lines of the Drosophila melanogaster Genetic Reference Panel (DGRP) and an advanced intercross outbred population derived from a subset of DGRP lines. Quantitative genetic analyses of life span and the micro-environmental variance of life span in the DGRP revealed significant genetic variance for both traits within each sex and environment, as well as significant genotype-by-sex interaction (GSI) and genotype-by-environment interaction (GEI). Genome-wide association (GWA) mapping in both populations implicates over 2,000 candidate genes with sex- and environment-specific or antagonistic pleiotropic allelic effects. Over 1,000 of these genes are associated with variation in life span in other D. melanogaster populations. We functionally assessed the effects of 15 candidate genes using RNA interference (RNAi): all affected life span and/or micro-environmental variance of life span in at least one sex and environment and exhibited sex-and environment-specific effects. Our results implicate novel candidate genes affecting life span and suggest that variation for life span may be maintained by variable allelic effects in heterogeneous environments.\nGWAS for Lifespan and Decline in Climbing Ability in Flies upon Dietary Restriction Reveal decima as a Mediator of Insulin-like Peptide Production\nAuthors: Wilson, Beck, Nelson, Hilsabeck, Promislow, Brem and Kapahi\nYear: 2020\nJournal: Current Biology\nDOI: https://doi.org/10.1016/j.cub.2020.05.020\nAbstract: Dietary restriction (DR) is the most robust means to extend lifespan and delay age-related diseases across species. An underlying assumption in the aging field is that DR enhances both lifespan and physical activity through similar mechanisms, but this has not been rigorously tested in different genetic backgrounds. Furthermore, nutrient response genes responsible for lifespan extension or age-related decline in functionality remain underexplored in natural populations. To address this, we measured nutrient-dependent changes in lifespan and age-related decline in climbing ability in the Drosophila Genetic Reference Panel fly strains. On average, DR extended lifespan and delayed decline in climbing ability, but there was a lack of correlation between these traits across individual strains, suggesting that distinct genetic factors modulate these traits independently and that genotype determines response to diet. Only 50% of strains showed positive response to DR for both lifespan and climbing ability, 14% showed a negative response for one trait but not both, and 35% showed no change in one or both traits. Through GWAS, we uncovered a number of genes previously not known to be diet responsive nor to influence lifespan or climbing ability. We validated decima as a gene that alters lifespan and daedalus as one that influences age-related decline in climbing ability. We found that decima influences insulin-like peptide transcription in the GABA receptor neurons downstream of short neuropeptide F precursor ( sNPF) signaling. Modulating these genes produced independent effects on lifespan and physical activity decline, which suggests that these age-related traits can be regulated through distinct mechanisms.\nIdentification of genetic modifiers of lifespan on a high sugar diet in the Drosophila Genetic Reference Panel\nAuthors: Patel and Talbert\nYear: 2021\nJournal: Heliyon\nDOI: https://doi.org/10.1016/j.heliyon.2021.e07153\nAbstract: Genome-wide association studies (GWAS) have become beneficial in identifying genetic variants underlying susceptibility to various complex diseases and conditions, including obesity. Utilizing the Drosophila Genetic Reference Panel (DGRP), we performed a GWAS of lifespan of 193 genetically distinct lines on a high sugar diet (HSD). The DGRP analysis pipeline determined the most significant lifespan associated polymorphisms were within loci of genes involved in: neural processes, behavior, development, and apoptosis, among other functions. Next, based on the relevance to obesity pathology, and the availability of transgenic RNAi lines targeting the genes we identified, whole-body in vivo knockdown of several candidate genes was performed. We utilized the GAL4-UAS binary expression system to independently validate the impacts of these loci on Drosophila lifespan during HSD. These loci were largely confirmed to affect lifespan in that HSD setting, as well as a normal diet setting. However, we also detected unexpected dietary effects of the HSD, including inconsistent diet effects on lifespan relative to a normal diet and a strong downregulation of feeding quantity.\nSex, mating and repeatability of Drosophila melanogaster longevity\nAuthors: Hoffman, Dudeck, Patterson and Austad\nYear: 2021\nJournal: Royal Society Open Science\nDOI: https://doi.org/10.1098/rsos.210273\nAbstract: Costs of reproduction are seemingly ubiquitous across the animal kingdom, and these reproductive costs are generally defined by increased reproduction leading to decreases in other fitness components, often longevity. However, some recent reports question whether reproductive costs exist in every species or population. To provide insight on this issue, we sought to determine the extent to which genetic variation might play a role in one type of reproductive cost—survival—using Drosophila melanogaster. We found, surprisingly, no costs of reproduction nor sex differences in longevity across all 15 genetic backgrounds in two cohorts. We did find significant variation within some genotypes, though these were much smaller than expected. We also observed that small laboratory changes lead to significant changes in longevity within genotypes, suggesting that longevity repeatability in flies may be difficult. We finally compared our results to previously published longevities and found that reproducibility is similar to what we saw in our own laboratory, further suggesting that stochasticity is a strong component of fruit fly lifespan. Overall, our results suggest that there are still large gaps in our knowledge about the effects of sex and mating, as well as genetic background and laboratory conditions on lifespan reproducibility.\nThe metabolome as a biomarker of aging in Drosophila melanogaster\nAuthors: Zhao, Golic, Harrison, Manoj, Hoffman, Simon, Johnson, MacCoss, McIntyre and Promislow\nYear: 2022\nJournal: Ageing Cell\nDOI: 10.1111/acel.13548\nAbstract: Many biomarkers have been shown to be associated not only with chronological age but also with functional measures of biological age. In human populations, it is difficult to show whether variation in biological age is truly predictive of life expectancy, as such research would require longitudinal studies over many years, or even decades. We followed adult cohorts of 20 Drosophila Genetic Reference Panel (DGRP) strains chosen to represent the breadth of lifespan variation, obtain estimates of lifespan, baseline mortality, and rate of aging, and associate these parameters with age-specific functional traits including fecundity and climbing activity and with age-specific targeted metabolomic profiles. We show that activity levels and metabolome-wide profiles are strongly associated with age, that numerous individual metabolites show a strong association with lifespan, and that the metabolome provides a biological clock that predicts not only sample age but also future mortality rates and lifespan. This study with 20 genotypes and 87 metabolites, while relatively small in scope, establishes strong proof of principle for the fly as a powerful experimental model to test hypotheses about biomarkers and aging and provides further evidence for the potential value of metabolomic profiles as biomarkers of aging."
  }
]